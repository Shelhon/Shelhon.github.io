<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">
  








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="数据库,学习,框架,Mybatis," />










<meta name="description" content="Mybatis框架学习一、Mybatis入门二、Dao开发方法三、SqlMapConfig.xml 配置文件四、Mapper.xml 映射文件">
<meta name="keywords" content="数据库,学习,框架,Mybatis">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis（一）">
<meta property="og:url" content="https://www.shelhon.cn/posts/da3e1361.html">
<meta property="og:site_name" content="无问西东">
<meta property="og:description" content="Mybatis框架学习一、Mybatis入门二、Dao开发方法三、SqlMapConfig.xml 配置文件四、Mapper.xml 映射文件">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://www.shelhon.cn/posts/da3e1361/1.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/da3e1361/2.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/da3e1361/3.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/da3e1361/4.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/da3e1361/5.png">
<meta property="og:updated_time" content="2018-11-06T04:33:50.382Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mybatis（一）">
<meta name="twitter:description" content="Mybatis框架学习一、Mybatis入门二、Dao开发方法三、SqlMapConfig.xml 配置文件四、Mapper.xml 映射文件">
<meta name="twitter:image" content="https://www.shelhon.cn/posts/da3e1361/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.shelhon.cn/posts/da3e1361.html"/>





  <title>Mybatis（一） | 无问西东</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3275656b1c327868bf311aa7c5fdabd2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	
	<a href="https://github.com/Shelhon/Shelhon.github.io" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">无问西东</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">糊涂脸水聪明枕</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shelhon.cn/posts/da3e1361.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qsx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无问西东">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Mybatis（一）</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-17T10:44:30+08:00">
                2018-09-17
              </time>
            

            

            
          </span>

    
    
        
            <span class="post-updated">
            &nbsp; | &nbsp; 更新于
            <time itemprop="dateUpdated" datetime="2018-11-06T12:33:50+08:00" content="2018-11-06">
                2018-11-06
            </time>
            </span>
        
		  
		 
		 
          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习过程/" itemprop="url" rel="index">
                    <span itemprop="name">学习过程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8,976
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  40
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong><center>Mybatis框架学习</center></strong><br>一、Mybatis入门<br>二、Dao开发方法<br>三、SqlMapConfig.xml 配置文件<br>四、Mapper.xml 映射文件</p>
<hr>
<a id="more"></a>
<h1 id="Mybatis入门"><a href="#Mybatis入门" class="headerlink" title="Mybatis入门"></a>Mybatis入门</h1><p>Mybatis开发dao两种方法：<br>一、原始dao开发方法，需要编写dao接口和dao实现类（跟ibatis一样）<br>二、Mybatis的mapper接口（相当于dao接口）代理开发方法。</p>
<h2 id="原生JDBC程序的总结"><a href="#原生JDBC程序的总结" class="headerlink" title="原生JDBC程序的总结"></a>原生JDBC程序的总结</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>学习用的是JDK 1.7<br>mysql:5.146</p>
<h3 id="创建实验数据库"><a href="#创建实验数据库" class="headerlink" title="创建实验数据库"></a>创建实验数据库</h3><p>从传智的课件里导入sql脚本生成数据库的表和数据<br>里面有一些用户表、订单、订单细节、价格表</p>
<h3 id="jdbc程序"><a href="#jdbc程序" class="headerlink" title="jdbc程序"></a>jdbc程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Shelhon</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>： 2018/9/17 14:31</span></span><br><span class="line"><span class="comment"> * DESCRIPTION:通过单独的JDBC程序来总结其中的问题 */</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTest</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Connection connection = <span class="keyword">null</span>;</span><br><span class="line">      PreparedStatement preparedStatement = <span class="keyword">null</span>;</span><br><span class="line">      ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//加载数据库驱动</span></span><br><span class="line">  Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">         <span class="comment">//通过驱动管理类获取数据库链接</span></span><br><span class="line">  connection = DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/mybatis?charac terEncoding=utf-8"</span>, <span class="string">"root"</span>, <span class="string">"12345"</span>);</span><br><span class="line">         <span class="comment">//定义sql语句 ?表示占位符</span></span><br><span class="line">  String sql = <span class="string">"select * from user where username = ?"</span>;</span><br><span class="line">         <span class="comment">//获取预处理statement</span></span><br><span class="line">  preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">         <span class="comment">//设置参数，第一个参数为sql语句中参数的序号（从1开始），第二个 参数为设置的参数值</span></span><br><span class="line">  preparedStatement.setString(<span class="number">1</span>, <span class="string">"王五"</span>);</span><br><span class="line">         <span class="comment">//向数据库发出sql执行查询，查询出结果集</span></span><br><span class="line">  resultSet = preparedStatement.executeQuery();</span><br><span class="line">         <span class="comment">//遍历查询结果集</span></span><br><span class="line">  <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">            System.out.println(resultSet.getString(<span class="string">"id"</span>) + <span class="string">" "</span> + resultSet.getString(<span class="string">"username"</span>));</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">//释放资源</span></span><br><span class="line">  <span class="keyword">if</span>(resultSet != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               resultSet.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">               <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">  e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (preparedStatement != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               preparedStatement.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">               <span class="comment">//TODO Auto-generated catch block</span></span><br><span class="line">  e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">               <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">  e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="jdbc编程步骤"><a href="#jdbc编程步骤" class="headerlink" title="jdbc编程步骤"></a>jdbc编程步骤</h3><p>1、 加载数据库驱动<br>2、 创建并获取数据库链接<br>3、 创建 jdbcstatement 对象<br>4、 设置 sql 语句<br>5、 设置 sql 语句中的参数(使用 preparedStatement)<br>6、 通过 statement 执行 sql 并获取结果<br>7、 对 sql 执行结果进行解析处理<br> 8、 释放资源(resultSet、preparedstatement、connection)</p>
<h3 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h3><ol>
<li>数据库连接，使用时才创建，不用就立即释放，对数据库进行频繁连接开启和关闭，造成数据库资源浪费，影响了数据库性能<br>解决方案：使用数据库连接池来管理数据库连接</li>
<li>将sql语句硬编码到Java代码中，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动 需要改变 java 代码。 </li>
<li>使用 preparedStatement 向占有位符号传参数存在硬编码，因为 sql 语句的 where 条件不 一定，可能多也可能少，修改 sql 还要修改代码，系统不易维护。 </li>
<li>对结果集解析存在硬编码（查询列名） ，sql 变化导致解析代码变化，系统不易维护，如 果能将数据库记录封装成 pojo 对象解析比较方便。</li>
</ol>
<hr>
<h2 id="Mybatis框架"><a href="#Mybatis框架" class="headerlink" title="Mybatis框架"></a>Mybatis框架</h2><h3 id="what"><a href="#what" class="headerlink" title="what"></a>what</h3><p>MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者 只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建 statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。<br> Mybatis通过xml或注解的方式将要执行的各种statement（statement、 preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql 进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并 返回。</p>
<h3 id="Mybatis-架构"><a href="#Mybatis-架构" class="headerlink" title="Mybatis 架构"></a>Mybatis 架构</h3><img src="/posts/da3e1361/1.png">
<p>1、mybatis 配置 SqlMapConfig.xml，此文件作为 mybatis 的全局配置文件，配置了 mybatis 的运行环境等信息。 mapper.xml 文件即 sql 映射文件，文件中配置了操作数据库的 sql 语句。此文件需要在 SqlMapConfig.xml 中加载。</p>
<p>2、 通过 mybatis 环境等配置信息构造 SqlSessionFactory 即会话工厂 </p>
<p>3、 由会话工厂创建 sqlSession 即会话，操作数据库需要通过 sqlSession 进行。 </p>
<p>4、mybatis 底层自定义了 Executor 执行器接口操作数据库，Executor 接口有两个实现，一个 是基本执行器、一个是缓存执行器。 </p>
<p>5、Mapped Statement 也是 mybatis 一个底层封装对象，它包装了 mybatis 配置信息及 sql 映射信息等。mapper.xml 文件中一个 sql 对应一个 MappedStatement 对象，sql 的 id 即 是 Mappedstatement 的 id。 </p>
<p>6、MappedStatement对sql执行输入参数进行定义，包括HashMap、基本类型、 pojo， Executor 通过 MappedStatement 在执行 sql 前将输入的 java 对象映射至 sql 中，输入参数映射就 是 jdbc 编程中对 preparedStatement 设置参数。 </p>
<p>7、MappedStatement对sql执行输出结果进行定义，包括HashMap、基本类型、 pojo， Executor 通过 MappedStatement 在执行 sql 后将输出结果映射至 java 对象中，输出结果映射过程 相当于 jdbc 编程中对结果的解析处理过程。</p>
<h2 id="入门程序"><a href="#入门程序" class="headerlink" title="入门程序"></a>入门程序</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>根据用户 id 查询一个用户信息<br>根据用户名称模糊查询用户信息列表<br>添加用户<br>更新用户<br>删除用户</p>
<h3 id="环境-1"><a href="#环境-1" class="headerlink" title="环境"></a>环境</h3><p>用jdk1.7<br>idea创建Java工程，<br>加入 mybatis 核心包、依赖包、数据驱动包。</p>
<h3 id="基本配置文件"><a href="#基本配置文件" class="headerlink" title="基本配置文件"></a>基本配置文件</h3><p>log4j.properties：日志功能<br>在 classpath 下创建 log4j.properties 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Global logging configuration </span><br><span class="line">log4j.rootLogger=DEBUG, stdout </span><br><span class="line"># Console output... log4j.appender.stdout=org.apache.log4j.ConsoleAppender </span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout </span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br></pre></td></tr></table></figure>
<p>mybatis 默认使用 log4j 作为输出日志信息。</p>
<p>SqlMapConfig.xml</p>
<p>在 classpath 下创建 SqlMapConfig.xml，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt; <span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span> <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 和spring整合后 environments配置将废除--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用jdbc事务管理--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库连接池--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis?characterEncoding=u tf-8"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"mysql"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>SqlMapConfig.xml 是 mybatis 核心配置文件，上边文件的配置内容为数据源、事务管理。</p>
<p>po 类<br>Po 类作为 mybatis 进行 sql 映射使用，po 类通常与数据库表对应，User.java 如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String username;<span class="comment">// 用户姓名</span></span><br><span class="line">	<span class="keyword">private</span> String sex;<span class="comment">// 性别</span></span><br><span class="line">	<span class="keyword">private</span> Date birthday;<span class="comment">// 生日</span></span><br><span class="line">	<span class="keyword">private</span> String address;<span class="comment">// 地址</span></span><br><span class="line"><span class="comment">//get/set……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着就是程序编写</p>
<p>在 classpath 下的 sqlmap 目录下创建 sql 映射文件 Users.xml（这是属于ibatis的命名方式）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt; <span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta"> "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 在映射文件中配置很多sql语句 --&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!-- 需求：通过id查询用户表的记录 --&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!-- 通过select执行数据库查询 </span></span><br><span class="line"><span class="comment">	id:标识 映射文件中的sql 将sql语句封装到mappedStatement对象中，所以将id称为Statement的id </span></span><br><span class="line"><span class="comment">	parameterType :指定输入参数的类型，这里指定int型 </span></span><br><span class="line"><span class="comment">	#&#123;&#125;表示一个占位符 </span></span><br><span class="line"><span class="comment">	#&#123;id&#125;:其中的id是表示接入输入的参数，参数名称就是id，如果输入参数是简单类型，#&#123;&#125;中的参数名可以任意可以value或者其他名称 </span></span><br><span class="line"><span class="comment">	resultType ：指定sql输出结果的所映射的Java对象类型，select指定resultType表示单条记录映射的Java对象 --&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">    		SELECT * FROM USER WHERE id=#&#123;id&#125; </span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 根据用户名称模糊查询用户信息，可能返回多条</span></span><br><span class="line"><span class="comment">$&#123;&#125;：表示拼接sql串，将接受到的参数内容不加任何修饰拼接在sql中</span></span><br><span class="line"><span class="comment">使用$&#123;&#125;拼接sql，可能会引起sql注入</span></span><br><span class="line"><span class="comment">$&#123;value&#125;：接收输入参数的内容，如果传入类型是简单类型，$&#123;&#125;中只能使用value</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByUsername"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">   		SELECT * FROM USER WHERE username LIKE '%$&#123;value&#125;%'</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>namespace ：命名空间，用于隔离sql语句，在使用mapper代理开发的时候，namespace有特殊重要作用。</p>
<p>在SqlMapConfig.xml中配置User.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 加载映射文件 --&gt; &lt;mappers&gt;</span><br><span class="line">    &lt;mapper resource=&quot;sqlmap/User.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure></p>
<p> 测试程序<br>MybatisFirst.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisFirst</span> </span>&#123;</span><br><span class="line">   <span class="comment">//会话工厂</span></span><br><span class="line">  <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createSqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">// 配置文件</span></span><br><span class="line">  String resource = <span class="string">"SqlMapConfig.xml"</span>;</span><br><span class="line">      InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">      <span class="comment">// 使用SqlSessionFactoryBuilder从xml配置文件中创建 SqlSessionFactory</span></span><br><span class="line">  sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 根据 id查询用户信息</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 数据库会话实例</span></span><br><span class="line">  SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// 创建数据库会话实例sqlSession</span></span><br><span class="line">  sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">         <span class="comment">// 查询单个记录，根据用户id查询用户信息</span></span><br><span class="line">  User user = sqlSession.selectOne(<span class="string">"test.findUserById"</span>,</span><br><span class="line">               <span class="number">10</span>);</span><br><span class="line">         <span class="comment">// 输出用户信息</span></span><br><span class="line">  System.out.println(user);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (sqlSession != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 根据用户名称模糊查询用户信息</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserByUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 数据库会话实例</span></span><br><span class="line">  SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// 创建数据库会话实例sqlSession</span></span><br><span class="line">  sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">         <span class="comment">// 查询单个记录，根据用户id查询用户信息</span></span><br><span class="line">  List&lt;User&gt; list =sqlSession.selectList(<span class="string">"test.findUserByUsername"</span>, <span class="string">"张"</span>);</span><br><span class="line">         System.out.println(list.size());</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (sqlSession != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>在 SqlMapConfig.xml 中添加<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加用户 --&gt;</span> <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">    insert into user(username,birthday,sex,address)</span><br><span class="line">    values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p> 测试程序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUserTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">      <span class="comment">// 插入用户对象</span></span><br><span class="line">  User user=<span class="keyword">new</span> User();</span><br><span class="line">      user.setUsername(<span class="string">"王小军"</span>);</span><br><span class="line">      user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">      user.setSex(<span class="string">"1"</span>);</span><br><span class="line">      user.setAddress(<span class="string">"河南"</span>);</span><br><span class="line">      sqlSession.insert(<span class="string">"test.insertUser"</span>,user);</span><br><span class="line">      sqlSession.commit();</span><br><span class="line">      sqlSession.close();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p>映射文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 删除用户</span></span><br><span class="line"><span class="comment"> 根据id删除用户，需要输入id值 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></span><br><span class="line">    delete from user where id =#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试程序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除id=30的用户 </span></span><br><span class="line"><span class="meta">@Test</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUserTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">   <span class="comment">// 删除用户对象    </span></span><br><span class="line">	sqlSession.insert(<span class="string">"test.deleteUser"</span>,<span class="number">30</span>);</span><br><span class="line">	sqlSession.commit();</span><br><span class="line">	sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="更新用户"><a href="#更新用户" class="headerlink" title="更新用户"></a>更新用户</h3><p>映射文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 更新用户</span></span><br><span class="line"><span class="comment"> 需要传入用户id和更新信息 parameterType指定User对象，包括id和更新信息，id必须存在 #&#123;id&#125;:从输入User对象中获取id属性值 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">    update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户 </span></span><br><span class="line"><span class="meta">@Test</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUserTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">   <span class="comment">//更新用户</span></span><br><span class="line">	User user=<span class="keyword">new</span> User();</span><br><span class="line">	user.setId(<span class="number">29</span>);</span><br><span class="line">	user.setUsername(<span class="string">"王小军update"</span>);</span><br><span class="line">	user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">	user.setSex(<span class="string">"1"</span>);</span><br><span class="line">	user.setAddress(<span class="string">"河南111"</span>);</span><br><span class="line">	sqlSession.insert(<span class="string">"test.updateUser"</span>,user);</span><br><span class="line">	System.out.println(user);</span><br><span class="line">	sqlSession.commit();</span><br><span class="line">	sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>一、 #{}和${}</p>
<h1 id="表示一个占位符号，通过-可以实现-preparedStatement-向占位符中设置值，自动进行-java-类型和-jdbc-类型转换，-可以有效防止-sql-注入。-可以接收简单类型值或-pojo-属性值。-如果-parameterType-传输单个简单类型值，-括号中可以是-value-或其它名称。"><a href="#表示一个占位符号，通过-可以实现-preparedStatement-向占位符中设置值，自动进行-java-类型和-jdbc-类型转换，-可以有效防止-sql-注入。-可以接收简单类型值或-pojo-属性值。-如果-parameterType-传输单个简单类型值，-括号中可以是-value-或其它名称。" class="headerlink" title="{}表示一个占位符号，通过#{}可以实现 preparedStatement 向占位符中设置值，自动进行 java 类型和 jdbc 类型转换，#{}可以有效防止 sql 注入。 #{}可以接收简单类型值或 pojo 属性值。 如果 parameterType 传输单个简单类型值，#{}括号中可以是 value 或其它名称。"></a>{}表示一个占位符号，通过#{}可以实现 preparedStatement 向占位符中设置值，自动进行 java 类型和 jdbc 类型转换，#{}可以有效防止 sql 注入。 #{}可以接收简单类型值或 pojo 属性值。 如果 parameterType 传输单个简单类型值，#{}括号中可以是 value 或其它名称。</h1><p>$ {}表示拼接 sql 串，通过$ {}可以将 parameterType 传入的内容拼接在 sql 中且不进行 jdbc 类 型转换，${}可以接收简单类型值或 pojo 属性值，如果 parameterType 传输单个简单类型值， $ {}括号中只能是 value。</p>
<p>二、 parameterType 和 resultType</p>
<p>parameterType：指定输入参数类型，mybatis 通过 ognl 从输入对象中获取参数值拼接在 sql 中。<br>resultType：指定输出结果类型，mybatis 将 sql 查询结果的一行记录数据映射为 resultType 指定类型的对象。</p>
<p>三、 selectOne 和 selectList</p>
<p>selectOne 查询一条记录，如果使用 selectOne 查询多条记录则抛出异常：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.exceptions.TooManyResultsException: </span><br><span class="line">Expected one result (or null) to be returned by selectOne(), but found: 3 </span><br><span class="line">at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultS qlSession.java:70)</span><br></pre></td></tr></table></figure></p>
<p>selectList 可以查询一条或多条记录。</p>
<p>四、 mysql 自增主键返回<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!-- selectKey将主键返回，需要再返回 --&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span> </span><br><span class="line">	select LAST_INSERT_ID() </span><br><span class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span> </span><br><span class="line">	insert into user(username,birthday,sex,address) </span><br><span class="line">	values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;); </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>添加 selectKey 实现将主键返回 keyProperty:返回的主键存储在 pojo 中的哪个属性<br>order：selectKey 的执行顺序，是相对与 insert 语句来说，由于 mysql 的自增原理执行 完 insert 语句之后才将主键生成，所以这里 selectKey 的执行顺序为 after<br> resultType:返回的主键是什么类型<br> LAST_INSERT_ID():是 mysql 的函数，返回 auto_increment 自增列新记录 id 值。</p>
<p>五、 Mysql 使用 uuid 实现主键</p>
<p>需要增加通过 selectuuid()得到 uuid 值<br>执行过程：<br>首先通过uuid()得到主键，将主键设置到User对象的id属性中<br>其次在insert执行时，从User对象中取出id属性值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">"java.lang.String"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"> select uuid() </span><br><span class="line"><span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span> </span><br><span class="line">insert into user(id,username,birthday,sex,address) </span><br><span class="line">	values(#&#123;id&#125;,#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意这里使用的 order 是“BEFORE”</p>
<p>六、 Oracle 使用序列生成主键</p>
<p>首先自定义一个序列且用于生成主键，selectKey 使用如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">"java.lang.String"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"> SELECT 自定义序列.NEXTVAL FROM DUAL </span><br><span class="line"><span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span> </span><br><span class="line">insert into user(id,username,birthday,sex,address) </span><br><span class="line">	values(#&#123;id&#125;,#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="mybatis与hibernate的区别和应用"><a href="#mybatis与hibernate的区别和应用" class="headerlink" title="mybatis与hibernate的区别和应用"></a>mybatis与hibernate的区别和应用</h2><p>hibernate：是一个标准的orm框架（对象关系映射），入门门槛比较高，不需要程序写sql，sql语句自动生成了。对SQL语句进行优化、修改比较困难。<br>应用场景：适用于需求变化不多的中小型项目，比如：后台管理系统，erp,orm,oa等</p>
<p>Mybatis：专注sql本身，需要程序员自己编写SQL语句，SQL修改，优化比较方便，Mybatis是一个不完全的orm框架，虽然程序员自己写sql，但是Mybatis也可以实现映射（输入映射，输出映射）。<br>应用场景：适用于需求变化较多的项目，比如，互联网项目</p>
<p>Mybatis 和 hibernate 不同，它不完全是一个 ORM 框架，因为 MyBatis 需要程序员自己 编写 Sql 语句，不过mybatis可以通过XML 或注解方式灵活配置要运行的 sql语句， 并将 java 对象和 sql 语句映射生成最终执行的 sql，最后将 sql 执行的结果再映射生成 java 对象。</p>
<p>Mybatis 学习门槛低，简单易学，程序员直接编写原生态 sql，可严格控制 sql 执行性能， 灵活度高，非常适合对关系数据模型要求不高的软件开发，例如互联网软件、企业运营类软 件等，因为这类软件需求变化频繁，一但需求变化要求成果输出迅速。但是灵活的前提是 mybatis 无法做到数据库无关性，如果需要实现支持多种数据库的软件则需要自定义多套 sql映射文件，工作量大。</p>
<p>Hibernate 对象/关系映射能力强，数据库无关性好，对于关系模型要求高的软件（例如 需求固定的定制化软件）如果用 hibernate 开发可以节省很多代码，提高效率。但是 Hibernate 的学习门槛高，要精通门槛更高，而且怎么设计 O/R 映射，在性能和对象模型之间如何权 衡，以及怎样用好 Hibernate 需要具有很强的经验和能力才行。 </p>
<p>总之，按照用户的需求在有限的资源环境下只要能做出维护性、扩展性良好的软件架构 都是好架构，所以框架只有适合才是最好。</p>
<h1 id="Dao-开发方法"><a href="#Dao-开发方法" class="headerlink" title="Dao 开发方法"></a>Dao 开发方法</h1><p>使用 Mybatis 开发 Dao，通常有两个方法，即原始 Dao 开发方法和 Mapper 接口开发方<br>法</p>
<h2 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h2><p>将下边的功能实现 Dao：<br> 根据用户 id 查询一个用户信息<br>根据用户名称模糊查询用户信息列表<br>添加用户信息</p>
<h2 id="SqlSession-的使用范围"><a href="#SqlSession-的使用范围" class="headerlink" title="SqlSession 的使用范围"></a>SqlSession 的使用范围</h2><p>SqlSession 中封装了对数据库的操作，如：查询、插入、更新、删除等。 通过 SqlSessionFactory 创建 SqlSession，而 SqlSessionFactory 是通过 SqlSessionFactoryBuilder 进行创建。</p>
<h3 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h3><p>SqlSessionFactoryBuilder 用于创建 SqlSessionFacoty，SqlSessionFacoty 一旦创建完成就不 需要 SqlSessionFactoryBuilder 了，因为 SqlSession 是通过 SqlSessionFactory 生产，所以可以 将 SqlSessionFactoryBuilder 当成一个工具类使用，不需要使用单例管理SqlSessionFactoryBuilder，在需要创建SqlSessionFactory的时候，只需要new一次SqlSessionFactoryBuilder即可，最佳使用范围是方法范围即方法体内局部变量。</p>
<h3 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h3><p>SqlSessionFactory是一个接口，接口中定义了openSession的不同重载方法 ， SqlSessionFactory 的最佳使用范围是整个应用运行期间，一旦创建后可以重复使用，通常以 单例模式管理 SqlSessionFactory。</p>
<h3 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h3><p>SqlSession 是一个面向用户的接口， sqlSession 中定义了数据库操作，如：selectont（返回单个对象）、selectList（返回单个或多个对象）默认使用 DefaultSqlSession 实现类。</p>
<p>执行过程如下：<br>1、 加载数据源等配置信息 Environmentenvironment=configuration.getEnvironment();<br>2、 创建数据库链接<br>3、 创建事务对象<br>4、 创建 Executor，SqlSession 所有操作都是通过 Executor 完成，mybatis 源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ExecutorType.BATCH == executorType) &#123;</span><br><span class="line">	executor = newBatchExecutor(<span class="keyword">this</span>, transaction); </span><br><span class="line">&#125; elseif (ExecutorType.REUSE == executorType) &#123;</span><br><span class="line">	executor = <span class="keyword">new</span> ReuseExecutor(<span class="keyword">this</span>, transaction); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">	executor = <span class="keyword">new</span> SimpleExecutor(<span class="keyword">this</span>, transaction);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (cacheEnabled) &#123;</span><br><span class="line">	executor = <span class="keyword">new</span> CachingExecutor(executor, autoCommit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、SqlSession 的实现类即 DefaultSqlSession，此对象中对操作数据库实质上用的是 Executor</p>
<p>结论： 每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不能共享使用，它也是 线程不安全的。因此最佳的范围是请求或方法范围。绝对不能将 SqlSession 实例的引用放在 一个类的静态字段或实例字段中。<br>打开一个 SqlSession；使用完毕就要关闭它。通常把这个关闭操作放到 finally 块中以 确保每次都能执行关闭。如下： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionsession=sqlSessionFactory.openSession(); </span><br><span class="line">	<span class="keyword">try</span>&#123; </span><br><span class="line">	<span class="comment">//dowork</span></span><br><span class="line">	 &#125;<span class="keyword">finally</span>&#123; </span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="原始-Dao-开发方式"><a href="#原始-Dao-开发方式" class="headerlink" title="原始 Dao 开发方式"></a>原始 Dao 开发方式</h2><p>原始 Dao 开发方法需要程序员编写 Dao 接口和 Dao 实现类。</p>
<p>映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt; </span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"test"</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 根据id获取用户信息 --&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"cn.itcast.mybatis.po.User"</span>&gt;</span> 			</span><br><span class="line">		select * from user where id = #&#123;id&#125; </span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 添加用户 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"cn.itcast.mybatis.po.User"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span> </span><br><span class="line">		select LAST_INSERT_ID() </span><br><span class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span> </span><br><span class="line">		insert into user(username,birthday,sex,address) </span><br><span class="line">		values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;) </span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Dao 接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">   <span class="comment">//根据id查询用户信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加用户信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//删除用户信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure></p>
<p>接口写完就写实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"><span class="comment">//注入SqlSessionFactory </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserDaoImpl</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span></span>&#123; </span><br><span class="line">		<span class="keyword">this</span>.setSqlSessionFactory(sqlSessionFactory);</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">private</span> SqlSessionFactory sqlSessionFactory; </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line">		User user = <span class="keyword">null</span>; </span><br><span class="line">		<span class="keyword">try</span> &#123; </span><br><span class="line">		<span class="comment">//通过sqlsession调用selectOne方法获取一条结果集 </span></span><br><span class="line">		<span class="comment">//参数1：指定定义的statement的id,参数2：指定向statement中传递的参数</span></span><br><span class="line">		user = session.selectOne(<span class="string">"test.findUserById"</span>, <span class="number">1</span>); </span><br><span class="line">		System.out.println(user);</span><br><span class="line">	&#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span> </span><br><span class="line">	<span class="function">Public <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">		SqlSession sqlSession = sqlSessionFactory.openSession(); </span><br><span class="line">		<span class="keyword">try</span> &#123; </span><br><span class="line">			sqlSession.insert(<span class="string">"insertUser"</span>, user); </span><br><span class="line">			sqlSession.commit(); </span><br><span class="line">		&#125; <span class="keyword">finally</span>&#123; </span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImplTest</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      <span class="comment">//创建sqlSessionFactory   </span></span><br><span class="line"><span class="comment">//mabatis配置文件  </span></span><br><span class="line">String resource =<span class="string">"SqlMapConfig.xml"</span>;</span><br><span class="line">      <span class="comment">//得到配置文件流</span></span><br><span class="line">  InputStream inputStream= Resources.getResourceAsStream(resource);</span><br><span class="line">      <span class="comment">//创建会话工厂，传入Mybatis的配置文件信息</span></span><br><span class="line">  sqlSessionFactory= <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      <span class="comment">//创建UserDao对象</span></span><br><span class="line">  UserDao userDao= <span class="keyword">new</span> UserDaoImpl(sqlSessionFactory);</span><br><span class="line">      <span class="comment">//调用UserDao方法</span></span><br><span class="line">  User user =userDao.findUserById(<span class="number">31</span>);</span><br><span class="line">      System.out.println(user);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      UserDao userDao =<span class="keyword">new</span> UserDaoImpl(sqlSessionFactory);</span><br><span class="line">      <span class="comment">//调用UserDao方法</span></span><br><span class="line">      User user= <span class="keyword">new</span> User();</span><br><span class="line">      user.setAddress(<span class="string">"gz"</span>);</span><br><span class="line">      user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">      user.setUsername(<span class="string">"abc1"</span>);</span><br><span class="line">      user.setSex(<span class="string">"女"</span>);</span><br><span class="line">      userDao.insertUser(user);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      UserDao userDao =<span class="keyword">new</span> UserDaoImpl(sqlSessionFactory);</span><br><span class="line">      userDao.deleteUser(<span class="number">31</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原始 Dao 开发中存在以下问题： </p>
<ul>
<li>Dao 方法体存在重复代码：通过 SqlSessionFactory 创建SqlSession，调用 SqlSession的数据库操作方法 </li>
<li>调用sqlSession的数据库操作方法需要指定statement的 id，这里存在硬编码，不利于开发维护。</li>
</ul>
<hr>
<h2 id="mapper代理方法"><a href="#mapper代理方法" class="headerlink" title="mapper代理方法"></a>mapper代理方法</h2><p>程序员只需要mapper接口，<br>还需要编写mapper.xml映射文件</p>
<p>程序员编写mapper接口需要遵循一些开发规范，这样Mybatis可以自动生成mapper接口实现类代理对象</p>
<p>Mapper 接口开发需要遵循以下规范：</p>
<ol>
<li>Mapper.xml 文件中的 namespace 与 mapper 接口的类路径相同。 </li>
<li>Mapper 接口方法名和 Mapper.xml 中定义的每个 statement 的 id 相同 </li>
<li>Mapper 接口方法的输入参数类型和 mapper.xml 中定义的每个 sql 的 parameterType 的 类型相同 </li>
<li>Mapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相</li>
</ol>
<h3 id="Mapper-xml-映射文件"><a href="#Mapper-xml-映射文件" class="headerlink" title="Mapper.xml(映射文件)"></a>Mapper.xml(映射文件)</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt; <span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta"> "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span> <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"mybatis.mapper.UserMapper"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在映射文件中配置很多sql语句 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 需求：通过id查询用户表的记录 --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">        SELECT * FROM USER WHERE id=#&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByUsername"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">        SELECT * FROM USER WHERE username LIKE '%$&#123;value&#125;%'</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加用户 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- selectKey将主键返回，需要再返回 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></span><br><span class="line">            select LAST_INSERT_ID()</span><br><span class="line">  	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into user(username,birthday,sex,address)</span><br><span class="line">        values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 删除用户</span></span><br><span class="line"><span class="comment"> 根据id删除用户，需要输入id值 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></span><br><span class="line">        delete from user where id =#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 更新用户</span></span><br><span class="line"><span class="comment"> 需要传入用户id和更新信息 parameterType指定User对象，包括id和更新信息，id必须存在 #&#123;id&#125;:从输入User对象中获取id属性值 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.User"</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Mapper-java-接口文件"><a href="#Mapper-java-接口文件" class="headerlink" title="Mapper.java(接口文件)"></a>Mapper.java(接口文件)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mybatis.first.User;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="comment">//根据id查询用户信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加用户信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//删除用户信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="加载-UserMapper-xml-文件"><a href="#加载-UserMapper-xml-文件" class="headerlink" title="加载 UserMapper.xml 文件"></a>加载 UserMapper.xml 文件</h3><p>修改 SqlMapConfig.xml 文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载映射文件 --&gt;</span> <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mapper/UserMapper.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="测试程序"><a href="#测试程序" class="headerlink" title="测试程序"></a>测试程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//创建sqlSessionFactory  </span></span><br><span class="line"> <span class="comment">//mabatis配置文件 </span></span><br><span class="line"> String resource =<span class="string">"SqlMapConfig.xml"</span>;</span><br><span class="line">      <span class="comment">//得到配置文件流</span></span><br><span class="line">  InputStream inputStream= Resources.getResourceAsStream(resource);</span><br><span class="line">      <span class="comment">//创建会话工厂，传入Mybatis的配置文件信息</span></span><br><span class="line">  sqlSessionFactory= <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">      <span class="comment">//创建UserMapper对象,mybatis自动生成mapper代理对象</span></span><br><span class="line">  UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">      <span class="comment">//调用UserMapper的方法</span></span><br><span class="line">  User user=userMapper.findUserById(<span class="number">1</span>);</span><br><span class="line">      System.out.println(user);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">	UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">	User user=<span class="keyword">new</span> User();</span><br><span class="line">	user.setSex(<span class="string">"难"</span>);</span><br><span class="line">	user.setUsername(<span class="string">"nan"</span>);</span><br><span class="line">	user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">	user.setAddress(<span class="string">"Bj"</span>);</span><br><span class="line">	userMapper.insertUser(user);</span><br><span class="line">	sqlSession.commit();<span class="comment">//少了这步会提交失败 </span></span><br><span class="line">	sqlSession.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">	UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">	userMapper.deleteUser(<span class="number">35</span>);</span><br><span class="line">	sqlSession.commit();<span class="comment">//少了这步会提交失败 </span></span><br><span class="line">	sqlSession.close();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>selectOne 和 selectList<br>动态代理对象调用sqlSession.selectOne()和sqlSession.selectList()是根据mapper接口方法的返 回值决定，如果返回 list 则调用 selectList 方法，如果返回单个对象则调用 selectOne 方法。</p>
</li>
<li><p>namespace<br>mybatis 官方推荐使用 mapper 代理方法开发 mapper 接口，程序员不用编写 mapper 接口实 现类，使用 mapper 代理方法时，输入参数可以使用 pojo 包装对象或 map 对象，保证 dao 的通用性。</p>
</li>
</ul>
<h1 id="SqlMapConfig-xml"><a href="#SqlMapConfig-xml" class="headerlink" title="SqlMapConfig.xml"></a>SqlMapConfig.xml</h1><h2 id="配置内容"><a href="#配置内容" class="headerlink" title="配置内容"></a>配置内容</h2><p>SqlMapConfig.xml 中配置的内容和顺序如下：</p>
<ul>
<li>properties（属性）</li>
<li>settings（全局配置参数）</li>
<li>typeAliases（类型别名）</li>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）</li>
<li>environments（环境集合属性对象）</li>
<li>environment（环境子属性对象）</li>
<li>transactionManager（事务管理）</li>
<li>dataSource（数据源）</li>
<li>mappers（映射器）</li>
</ul>
<h3 id="properties（属性）"><a href="#properties（属性）" class="headerlink" title="properties（属性）"></a>properties（属性）</h3><p>需求：<br>将数据库连接参数单独配置在db.properties中，只需要在SqlMapConfig.xml中加载db.properties的属性值。在SqlMapConfig.xml中不需要对数据库连接参数硬编码。</p>
<p>db.properties文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver jdbc.url=jdbc:mysql://localhost:3306/mybatis？characterEncoding=utf-8 </span><br><span class="line">jdbc.username=root </span><br><span class="line">jdbc.password=12345</span><br></pre></td></tr></table></figure></p>
<p>SqlMapConfig.xml部分配置内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载属性文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- properties中还可以配置一些属性名和属性值  --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 比如&lt;property name="jdbc.driver" value=""/&gt; --&gt;</span>  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 和spring整合后 environments配置将废除--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用jdbc事务管理--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库连接池--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意： MyBatis 将按照下面的顺序来加载属性： </p>
<ul>
<li>在 properties 元素体内定义的属性首先被读取。 </li>
<li>然后会读取 properties 元素中 resource 或 url 加载的属性，它会覆盖已读取的同名属 性。 </li>
<li>最后读取 parameterType 传递的属性，它会覆盖已读取的同名属性。</li>
</ul>
<p>因此，通过 parameterType 传递的属性具有最高优先级，resource 或 url 加载的属性次之， 最低优先级的是 properties 元素体内定义的属性。</p>
<p>建议：不要在properties元素体内体检任何属性值，只将属性值定义在properties文件中，在properties文件中定义属性名也要有一定的特殊性。</p>
<h3 id="settings全局参数配置（配置）"><a href="#settings全局参数配置（配置）" class="headerlink" title="settings全局参数配置（配置）"></a>settings全局参数配置（配置）</h3><p>Mybatis在运行时可以调整一些运行参数</p>
<p>mybatis 全局配置参数，全局参数将会影响 mybatis 的运行行为。</p>
<p>比如：开启二级缓存，开启延迟加载</p>
<img src="/posts/da3e1361/2.png">
<img src="/posts/da3e1361/3.png">
<img src="/posts/da3e1361/4.png">
<h3 id="typeAliases-别名"><a href="#typeAliases-别名" class="headerlink" title="typeAliases(别名)"></a>typeAliases(别名)</h3><p>在mapper.xml中，定义很多statement，statement需要parameterType指定输入参数的类型，需要resultType指定输出结果的映射类型。</p>
<p>如果在指定类型时输入类型全路径，不方便开发，可以针对parameterType或resultType指定类型定义一些别名，在mapper.xml中通过别名定义，方便开发</p>
<h4 id="mybatis-支持别名："><a href="#mybatis-支持别名：" class="headerlink" title="mybatis 支持别名："></a>mybatis 支持别名：</h4><p>别名 映射的类型<br>_byte byte<br>_long long<br>_short short<br>_int int<br>_integer int<br>_double double<br>_float float<br>_boolean boolean<br>string String<br>byte Byte<br>long Long<br>short Short<br>int Integer<br>integer Integer<br>double Double<br>float Float<br>boolean Boolean<br>date Date<br>decimal BigDecimal<br>bigdecimal BigDecimal</p>
<h4 id="自定义别名"><a href="#自定义别名" class="headerlink" title="自定义别名"></a>自定义别名</h4><p>在 SqlMapConfig.xml 中配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!-- 单个别名定义 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.User"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以）--&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.itcast.mybatis.po"</span>/&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">" 其 它 包 "</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- 批量别名定义 </span></span><br><span class="line"><span class="comment">指定包名，Mybatis自动扫描包中的po类，自动定义别名，别名就是类名（首字母大写小写都可以） --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"mybatis.first"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>也就是说只需要写到包名里，不用写到具体的类</p>
<h3 id="typeHandlers类型处理器"><a href="#typeHandlers类型处理器" class="headerlink" title="typeHandlers类型处理器"></a>typeHandlers类型处理器</h3><p>类型处理器用于 java 类型和 jdbc 类型映射，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span> </span><br><span class="line">	select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>mybatis 自带的类型处理器基本上满足日常需求，不需要单独定义。</p>
<p>mybatis 支持类型处理器：</p>
<img src="/posts/da3e1361/5.png">
<h1 id="mappers-映射器"><a href="#mappers-映射器" class="headerlink" title="mappers(映射器)"></a>mappers(映射器)</h1><h2 id="Mapper-配置的几种方法："><a href="#Mapper-配置的几种方法：" class="headerlink" title="Mapper 配置的几种方法："></a>Mapper 配置的几种方法：</h2><h3 id=""><a href="#" class="headerlink" title=""></a><mapper resource=" "></mapper></h3><p>使用相对于类路径的资源<br>如：<mapper resource="sqlmap/User.xml"></mapper></p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a><mapper url=" "></mapper></h3><p>使用完全限定路径<br>如：<mapper url="file:///D:\workspace_spingmvc\mybatis_01\config\sqlmap\User.xml"></mapper></p>
<h3 id="-2"><a href="#-2" class="headerlink" title=""></a><mapper class=" "></mapper></h3><p>使用 mapper 接口类路径<br>如：<mapper class="mybatis.mapper.UserMapper"></mapper></p>
<p>注意：此种方法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。<br>就是将mapper.java和mapper.xml放在一起且同名。</p>
<h3 id="-3"><a href="#-3" class="headerlink" title=""></a><package name=" "></package></h3><p>批量加载<br>注册指定包下的所有 mapper 接口<br> 如：<package name="mybatis.mapper"><br>实际测试似乎：<package name="mybatis">这样也是可以加载的。<br>注意：此种方法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</package></package></p>
<hr>
<h2 id="Mapper-xml映射文件"><a href="#Mapper-xml映射文件" class="headerlink" title="Mapper.xml映射文件"></a>Mapper.xml映射文件</h2><p>Mapper.xml 映射文件中定义了操作数据库的 sql，每个 sql 是一个 statement，映射文件 是 mybatis 的核心。</p>
<h3 id="输入映射"><a href="#输入映射" class="headerlink" title="输入映射"></a>输入映射</h3><h4 id="传递pojo对象"><a href="#传递pojo对象" class="headerlink" title="传递pojo对象"></a>传递pojo对象</h4><p>Mybatis 使用 ognl 表达式解析对象字段的值，如下例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">!—传递pojo对象综合查询用户信息</span> <span class="attr">--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByUser"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">	select * from user where id=#&#123;id&#125; and username like '%$&#123;username&#125;%' </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的id和username是 user 对象中的字段名称。</p>
<h4 id="传递pojo的包装对象"><a href="#传递pojo的包装对象" class="headerlink" title="传递pojo的包装对象"></a>传递pojo的包装对象</h4><p>开发中通过 pojo 传递查询条件 ，查询条件是综合的查询条件，不仅包括用户查询条件 还包括其它的查询条件（比如将用户购买商品信息也作为查询条件），这时可以使用包装对 象传递输入参数。</p>
<ol>
<li>定义包装对象<br>定义包装对象将查询条件(pojo)以类组合的方式包装起来。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserQueryVo</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	<span class="comment">//自定义用户扩展类 </span></span><br><span class="line">	<span class="keyword">private</span> UserCustom userCustom;</span><br></pre></td></tr></table></figure>
<ol>
<li>mapper.xml 映射文件<br>在userMapper.xml中定义用户信息综合查询（查询条件复杂，通过高级查询进行）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用户信息综合查询 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.UserQueryVo"</span> <span class="attr">resultType</span>=<span class="string">"mybatis.first.UserCustom"</span>&gt;</span></span><br><span class="line">    select * from user where user.sex =#&#123;userCustom.sex&#125; and USER .username like '%$&#123;userCustom.username&#125;%'</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>UserMapper.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用户信息综合查询 </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserCustom&gt; <span class="title">findUserList</span><span class="params">(UserQueryVo userQueryVo)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure></p>
<p>测试程序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findUserList</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">   SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">   UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//创建包装对象，设置查询条件</span></span><br><span class="line">   UserQueryVo userQueryVo= <span class="keyword">new</span> UserQueryVo();</span><br><span class="line">   UserCustom userCustom =<span class="keyword">new</span> UserCustom();</span><br><span class="line">   userCustom.setSex(<span class="string">"1"</span>);</span><br><span class="line">   userCustom.setUsername(<span class="string">"张三丰"</span>);</span><br><span class="line">   userQueryVo.setUserCustom(userCustom);</span><br><span class="line">   List&lt;UserCustom&gt; userCustoms=userMapper.findUserList(userQueryVo);</span><br><span class="line"></span><br><span class="line">   System.out.println(userCustoms);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="传递hashmap"><a href="#传递hashmap" class="headerlink" title="传递hashmap"></a>传递hashmap</h4><p>Sql 映射文件定义如下:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 传递hashmap综合查询用户信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByHashmap"</span> <span class="attr">parameterType</span>=<span class="string">"hashmap"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">	select * from user where id=#&#123;id&#125; and username like '%$&#123;username&#125;%' </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其中id和username是hashmap的key</p>
<h3 id="输出映射"><a href="#输出映射" class="headerlink" title="输出映射"></a>输出映射</h3><h4 id="输出简单类型"><a href="#输出简单类型" class="headerlink" title="输出简单类型"></a>输出简单类型</h4><p>Mapper.xml 文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 获取用户列表总数 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserCount"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span> </span><br><span class="line">select count(1) from user </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testFindUserCount</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获取mapper接口实例 </span></span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">User user = <span class="keyword">new</span> User(); </span><br><span class="line">user.setUsername(<span class="string">"管理员"</span>);</span><br><span class="line"><span class="comment">//传递Hashmap对象查询用户列表 </span></span><br><span class="line"><span class="keyword">int</span> count = userMapper.findUserCount(user);</span><br><span class="line"><span class="comment">//关闭session </span></span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>总结： 输出简单类型必须查询出来的结果集有一条记录，最终将第一个字段的值转换为输出类型。 使用 session 的 selectOne 可查询单条记录。</p>
<h4 id="输出-pojo-对象"><a href="#输出-pojo-对象" class="headerlink" title="输出 pojo 对象"></a>输出 pojo 对象</h4><p>Mapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据id查询用户信息 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span> </span><br><span class="line">select * from user where id = #&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Mapper 接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过mapper接口调用statement </span></span><br><span class="line">User user = userMapper.findUserById(<span class="number">1</span>); </span><br><span class="line">System.out.println(user); </span><br><span class="line"><span class="comment">//关闭session </span></span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用 session 调用 selectOne 查询单条记录。</p>
<h4 id="输出-pojo-列表"><a href="#输出-pojo-列表" class="headerlink" title="输出 pojo 列表"></a>输出 pojo 列表</h4><p>参考 selectUserByName 的定义： Mapper.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据名称模糊查询用户信息 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByUsername"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span> </span><br><span class="line">select * from user where username like '%$&#123;value&#125;%' </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Mapper 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testFindUserByUsername</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//如果使用占位符号则必须人为在传参数中加%</span></span><br><span class="line"> <span class="comment">//List&lt;User&gt; list = userMapper.selectUserByName("%管理员%"); </span></span><br><span class="line"><span class="comment">//如果使用$&#123;&#125;原始符号则不用人为在参数中加% </span></span><br><span class="line">List&lt;User&gt; list = userMapper.findUserByUsername(<span class="string">"管理员"</span>); </span><br><span class="line"><span class="comment">//关闭session </span></span><br><span class="line">session.close(); &#125;</span><br></pre></td></tr></table></figure>
<p>使用 session 的 selectList 方法获取 pojo 列表。</p>
<p>resultType 总结：<br>输出 pojo 对象和输出 pojo 列表在 sql 中定义的 resultType 是一样的。 返回单个 pojo 对象要保证 sql 查询出来的结果集为单条，内部使用 session.selectOne 方法调 用，mapper 接口使用 pojo 对象作为方法返回值。<br>返回 pojo 列表表示查询出来的结果集可能为多条，内部使用 session.selectList 方法，mapper 接口使用 List<pojo>对象作为方法返回值。</pojo></p>
<h4 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h4><p>Mybatis中使用resultMap完成高级输出结果映射</p>
<p>resultType 可以指定 pojo 将查询结果映射为 pojo，但需要 pojo 的属性名和 sql 查询的列 名一致方可映射成功。 如果 sql 查询字段名和 pojo 的属性名不一致，可以通过 resultMap 将字段名和属性名作 一个对应关系 ，resultMap 实质上还需要将查询结果映射到 pojo 对象中。 resultMap 可以实现将查询结果映射为复杂类型的 pojo，比如在查询结果映射对象中包 括 pojo 和 list 实现一对一查询和一对多查询。</p>
<p>1、定义resultMap</p>
<p>2、使用resultMap作为statement的输出映射类型</p>
<hr>
<h2 id="动态sql"><a href="#动态sql" class="headerlink" title="动态sql"></a>动态sql</h2><p>mybatis核心，对sql语句进行灵活操作，通过表达式判断，对sql进行灵活拼凑、组装</p>
<p>需求：用户信息综合查询列表和用户信息查询列表总数这两个statement的定义使用动态sql</p>
<p>对查询条件进行判断，如果输入参数不为空才进行查询</p>
<p>mapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用户信息综合查询 --&gt;</span> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.UserQueryVo"</span> <span class="attr">resultType</span>=<span class="string">"mybatis.first.UserCustom"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom!=null"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom.sex!= null and userCustom.sex!=''"</span>&gt;</span></span><br><span class="line">            and user.sex =#&#123;userCustom.sex&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom.username!=null and userCustom.username !=''"</span>&gt;</span></span><br><span class="line">            and user.username like '%$&#123;userCustom.username&#125;%'</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>里面用到了where和if标签<br>注意里面的要做不等于空字符串校验。</p>
<p><where>可以自动处理第一个 and。</where></p>
<h2 id="Sql-片段"><a href="#Sql-片段" class="headerlink" title="Sql 片段"></a>Sql 片段</h2><p>Sql 中可将重复的 sql 提取出来，使用时用 include 引用即可，最终达到 sql 重用的目的，如 下：</p>
<p>mapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义sql片断 id:sql片断是唯一表示 经验：是基于单表来定义sql片断，这样的话这个sql片断可重用性才高 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"query_user_where"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom!=null"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom.sex!= null and userCustom.sex!=''"</span>&gt;</span></span><br><span class="line">                and user.sex =#&#123;userCustom.sex&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom.username!=null and userCustom.username !=''"</span>&gt;</span></span><br><span class="line">                and user.username like '%$&#123;userCustom.username&#125;%'</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在where中使用 include 引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用户信息综合查询 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserList"</span> <span class="attr">parameterType</span>=<span class="string">"mybatis.first.UserQueryVo"</span> <span class="attr">resultType</span>=<span class="string">"mybatis.first.UserCustom"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"query_user_where"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：如果引用其它 mapper.xml 的 sql 片段，则在引用时需要加上 namespace，如下： &lt;include refid=”namespace.sql 片段”/&gt;</p>
<h2 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h2><p>在用户查询列表和查询总数的statement中增加多个输入查询<br>sql语句如下：<br>①select * from user where id =1 or id =2 or id=3</p>
<p>②select * from user where id IN(1,10,16)</p>
<p>现在要在输入参数类型中添加LIST<integer>ids传入多个id</integer></p>
<p>UserQueryVo.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserQueryVo</span> </span>&#123;</span><br><span class="line">   <span class="comment">//传入多个id</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Integer&gt; ids;</span><br></pre></td></tr></table></figure></p>
<p>mapper.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"query_user_where"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom!=null"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom.sex!= null and userCustom.sex!=''"</span>&gt;</span></span><br><span class="line">                and user.sex =#&#123;userCustom.sex&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCustom.username!=null and userCustom.username !=''"</span>&gt;</span></span><br><span class="line">                and user.username like '%$&#123;userCustom.username&#125;%'</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids!=null"</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 使用foreach来遍历传入ids</span></span><br><span class="line"><span class="comment">          collection：指定输入对象中集合属性 </span></span><br><span class="line"><span class="comment">            item：每个遍历生成对象 </span></span><br><span class="line"><span class="comment">            open：开始遍历时拼接的串 </span></span><br><span class="line"><span class="comment">             close：结束遍历时拼接的串 </span></span><br><span class="line"><span class="comment">          separator：遍历的两个对象中需要拼接的串 --&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">open</span>=<span class="string">"and ("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">separator</span>=<span class="string">"or"</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 每个遍历需要拼接的串 --&gt;</span></span><br><span class="line">             id =#&#123;id&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findUserList</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">   UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">   <span class="comment">//创建包装对象，设置查询条件</span></span><br><span class="line">  UserQueryVo userQueryVo = <span class="keyword">new</span> UserQueryVo();</span><br><span class="line">   UserCustom userCustom = <span class="keyword">new</span> UserCustom();</span><br><span class="line"> <span class="comment">//传入多个id  </span></span><br><span class="line">   List&lt;Integer&gt; ids= <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">   ids.add(<span class="number">1</span>);</span><br><span class="line">   ids.add(<span class="number">8</span>);</span><br><span class="line">   ids.add(<span class="number">26</span>);</span><br><span class="line">   userQueryVo.setIds(ids);</span><br><span class="line">   userQueryVo.setUserCustom(userCustom);</span><br><span class="line">   List&lt;UserCustom&gt; userCustoms = userMapper.findUserList(userQueryVo);</span><br><span class="line">   System.out.println(userCustoms);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一开始的第二种查询的实现方式<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">open</span>=<span class="string">"and id IN ("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Just for fun!</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="Qsx 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

	<div>
		
			<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------<i class="fa fa-paw"></i> 文章已经到尾 <i class="fa fa-paw"></i>-------------</div>
    
</div>

		
	</div>
	
	
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/数据库/" rel="tag"># 数据库</a>
          
            <a href="/tags/学习/" rel="tag"># 学习</a>
          
            <a href="/tags/框架/" rel="tag"># 框架</a>
          
            <a href="/tags/Mybatis/" rel="tag"># Mybatis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/3b200332.html" rel="next" title="数据库系统篇">
                <i class="fa fa-chevron-left"></i> 数据库系统篇
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/c574728f.html" rel="prev" title="Mybatis（二）">
                Mybatis（二） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Qsx" />
            
              <p class="site-author-name" itemprop="name">Qsx</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Shelhon" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ppp00qqq@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/qsxmybaby" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://zhihu.com/people/shelhon" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.kofes.cn/" title="cz" target="_blank">cz</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Mybatis入门"><span class="nav-number">1.</span> <span class="nav-text">Mybatis入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#原生JDBC程序的总结"><span class="nav-number">1.1.</span> <span class="nav-text">原生JDBC程序的总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#环境"><span class="nav-number">1.1.1.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建实验数据库"><span class="nav-number">1.1.2.</span> <span class="nav-text">创建实验数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jdbc程序"><span class="nav-number">1.1.3.</span> <span class="nav-text">jdbc程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jdbc编程步骤"><span class="nav-number">1.1.4.</span> <span class="nav-text">jdbc编程步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#问题总结"><span class="nav-number">1.1.5.</span> <span class="nav-text">问题总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis框架"><span class="nav-number">1.2.</span> <span class="nav-text">Mybatis框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what"><span class="nav-number">1.2.1.</span> <span class="nav-text">what</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mybatis-架构"><span class="nav-number">1.2.2.</span> <span class="nav-text">Mybatis 架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#入门程序"><span class="nav-number">1.3.</span> <span class="nav-text">入门程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#需求"><span class="nav-number">1.3.1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#环境-1"><span class="nav-number">1.3.2.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本配置文件"><span class="nav-number">1.3.3.</span> <span class="nav-text">基本配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加用户"><span class="nav-number">1.3.4.</span> <span class="nav-text">添加用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除用户"><span class="nav-number">1.3.5.</span> <span class="nav-text">删除用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新用户"><span class="nav-number">1.3.6.</span> <span class="nav-text">更新用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">1.3.7.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#表示一个占位符号，通过-可以实现-preparedStatement-向占位符中设置值，自动进行-java-类型和-jdbc-类型转换，-可以有效防止-sql-注入。-可以接收简单类型值或-pojo-属性值。-如果-parameterType-传输单个简单类型值，-括号中可以是-value-或其它名称。"><span class="nav-number">2.</span> <span class="nav-text">{}表示一个占位符号，通过#{}可以实现 preparedStatement 向占位符中设置值，自动进行 java 类型和 jdbc 类型转换，#{}可以有效防止 sql 注入。 #{}可以接收简单类型值或 pojo 属性值。 如果 parameterType 传输单个简单类型值，#{}括号中可以是 value 或其它名称。</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis与hibernate的区别和应用"><span class="nav-number">2.1.</span> <span class="nav-text">mybatis与hibernate的区别和应用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dao-开发方法"><span class="nav-number">3.</span> <span class="nav-text">Dao 开发方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-1"><span class="nav-number">3.1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SqlSession-的使用范围"><span class="nav-number">3.2.</span> <span class="nav-text">SqlSession 的使用范围</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SqlSessionFactoryBuilder"><span class="nav-number">3.2.1.</span> <span class="nav-text">SqlSessionFactoryBuilder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SqlSessionFactory"><span class="nav-number">3.2.2.</span> <span class="nav-text">SqlSessionFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SqlSession"><span class="nav-number">3.2.3.</span> <span class="nav-text">SqlSession</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原始-Dao-开发方式"><span class="nav-number">3.3.</span> <span class="nav-text">原始 Dao 开发方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mapper代理方法"><span class="nav-number">3.4.</span> <span class="nav-text">mapper代理方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mapper-xml-映射文件"><span class="nav-number">3.4.1.</span> <span class="nav-text">Mapper.xml(映射文件)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mapper-java-接口文件"><span class="nav-number">3.4.2.</span> <span class="nav-text">Mapper.java(接口文件)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加载-UserMapper-xml-文件"><span class="nav-number">3.4.3.</span> <span class="nav-text">加载 UserMapper.xml 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试程序"><span class="nav-number">3.4.4.</span> <span class="nav-text">测试程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">3.4.5.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SqlMapConfig-xml"><span class="nav-number">4.</span> <span class="nav-text">SqlMapConfig.xml</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置内容"><span class="nav-number">4.1.</span> <span class="nav-text">配置内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#properties（属性）"><span class="nav-number">4.1.1.</span> <span class="nav-text">properties（属性）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#settings全局参数配置（配置）"><span class="nav-number">4.1.2.</span> <span class="nav-text">settings全局参数配置（配置）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#typeAliases-别名"><span class="nav-number">4.1.3.</span> <span class="nav-text">typeAliases(别名)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mybatis-支持别名："><span class="nav-number">4.1.3.1.</span> <span class="nav-text">mybatis 支持别名：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义别名"><span class="nav-number">4.1.3.2.</span> <span class="nav-text">自定义别名</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#typeHandlers类型处理器"><span class="nav-number">4.1.4.</span> <span class="nav-text">typeHandlers类型处理器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mappers-映射器"><span class="nav-number">5.</span> <span class="nav-text">mappers(映射器)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mapper-配置的几种方法："><span class="nav-number">5.1.</span> <span class="nav-text">Mapper 配置的几种方法：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">5.1.1.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#-1"><span class="nav-number">5.1.2.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#-2"><span class="nav-number">5.1.3.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#-3"><span class="nav-number">5.1.4.</span> <span class="nav-text"></span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mapper-xml映射文件"><span class="nav-number">5.2.</span> <span class="nav-text">Mapper.xml映射文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#输入映射"><span class="nav-number">5.2.1.</span> <span class="nav-text">输入映射</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#传递pojo对象"><span class="nav-number">5.2.1.1.</span> <span class="nav-text">传递pojo对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#传递pojo的包装对象"><span class="nav-number">5.2.1.2.</span> <span class="nav-text">传递pojo的包装对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#传递hashmap"><span class="nav-number">5.2.1.3.</span> <span class="nav-text">传递hashmap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#输出映射"><span class="nav-number">5.2.2.</span> <span class="nav-text">输出映射</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#输出简单类型"><span class="nav-number">5.2.2.1.</span> <span class="nav-text">输出简单类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#输出-pojo-对象"><span class="nav-number">5.2.2.2.</span> <span class="nav-text">输出 pojo 对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#输出-pojo-列表"><span class="nav-number">5.2.2.3.</span> <span class="nav-text">输出 pojo 列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resultMap"><span class="nav-number">5.2.2.4.</span> <span class="nav-text">resultMap</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态sql"><span class="nav-number">5.3.</span> <span class="nav-text">动态sql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sql-片段"><span class="nav-number">5.4.</span> <span class="nav-text">Sql 片段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#foreach"><span class="nav-number">5.5.</span> <span class="nav-text">foreach</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qsx</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">118.9k</span>
  
</div>










        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</body>

</html>
