<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">
  








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="数据库,学习,框架,Mybatis," />










<meta name="description" content="Mybatis框架学习一、关联查询二、查询缓存三、与Spring整合四、Mybatis 逆向工程">
<meta name="keywords" content="数据库,学习,框架,Mybatis">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis（二）">
<meta property="og:url" content="https://www.shelhon.cn/posts/c574728f.html">
<meta property="og:site_name" content="无问西东">
<meta property="og:description" content="Mybatis框架学习一、关联查询二、查询缓存三、与Spring整合四、Mybatis 逆向工程">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/1.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/2.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/3.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/4.png">
<meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/5.png">
<meta property="og:updated_time" content="2018-11-06T04:34:15.638Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mybatis（二）">
<meta name="twitter:description" content="Mybatis框架学习一、关联查询二、查询缓存三、与Spring整合四、Mybatis 逆向工程">
<meta name="twitter:image" content="https://www.shelhon.cn/posts/c574728f/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.shelhon.cn/posts/c574728f.html"/>





  <title>Mybatis（二） | 无问西东</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3275656b1c327868bf311aa7c5fdabd2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	
	<a href="https://github.com/Shelhon/Shelhon.github.io" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">无问西东</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">糊涂脸水聪明枕</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shelhon.cn/posts/c574728f.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qsx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无问西东">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Mybatis（二）</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-27T10:44:03+08:00">
                2018-09-27
              </time>
            

            

            
          </span>

    
    
        
            <span class="post-updated">
            &nbsp; | &nbsp; 更新于
            <time itemprop="dateUpdated" datetime="2018-11-06T12:34:15+08:00" content="2018-11-06">
                2018-11-06
            </time>
            </span>
        
		  
		 
		 
          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习过程/" itemprop="url" rel="index">
                    <span itemprop="name">学习过程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7,700
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  32
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong><center>Mybatis框架学习</center></strong><br>一、关联查询<br>二、查询缓存<br>三、与Spring整合<br>四、Mybatis 逆向工程</p>
<hr>
<a id="more"></a>
<h1 id="关联查询"><a href="#关联查询" class="headerlink" title="关联查询"></a>关联查询</h1><h2 id="商品订单数据模型"><a href="#商品订单数据模型" class="headerlink" title="商品订单数据模型"></a>商品订单数据模型</h2><h3 id="数据模型分析思路"><a href="#数据模型分析思路" class="headerlink" title="数据模型分析思路"></a>数据模型分析思路</h3><ol>
<li><p>每张表记录的数据内容<br>分模块对每张表记录的内容进行熟悉，相当于学习系统需求（功能）的过程</p>
</li>
<li><p>每张表数据库字段设置<br>非空字段，外键字段</p>
</li>
<li><p>数据库级别表与表之间的关系<br>外键关系 </p>
</li>
<li>表与表之间的业务关系<br>在分析表与表之间的业务关系时一定要建立在某个业务意义基础上去分析</li>
</ol>
<h3 id="数据模型的分析"><a href="#数据模型的分析" class="headerlink" title="数据模型的分析"></a>数据模型的分析</h3><p>用户表User：<br>记录了购买商品的用户信息</p>
<p>订单表orders:<br>记录了用户所创建的订单</p>
<p>订单明细表odersdetail：<br>记录了订单的详细信息，即购买的商品信息</p>
<p>商品表：items<br>记录了商品信息</p>
<img src="/posts/c574728f/1.png">
<h2 id="一对一查询"><a href="#一对一查询" class="headerlink" title="一对一查询"></a>一对一查询</h2><p>查询订单信息，管理查询创建订单的与用户信息</p>
<p>注意：因为一个订单信息只会是一个人下的订单，所以从查询订单信息出发关联查询用户信 息为一对一查询。如果从用户信息出发查询用户下的订单信息则为一对多查询，因为一个用 户可以下多个订单。</p>
<h3 id="方法一：使用-resultType"><a href="#方法一：使用-resultType" class="headerlink" title="方法一：使用 resultType"></a>方法一：使用 resultType</h3><p>定义订单信息 po 类，此 po 类中包括了订单信息和用户信息</p>
<p>sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, user.username, userss.address </span><br><span class="line"><span class="keyword">FROM</span> orders, <span class="keyword">user</span> </span><br><span class="line"><span class="keyword">WHERE</span> orders.user_id=user.id</span><br></pre></td></tr></table></figure>
<p>定义 po 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrdersCustom</span> <span class="keyword">extends</span> <span class="title">Orders</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;<span class="comment">// 用户名称 </span></span><br><span class="line">    <span class="keyword">private</span> String address;<span class="comment">// 用户地址 </span></span><br><span class="line">    get/set。。。</span><br></pre></td></tr></table></figure>
<p>OrdersCustom 类继承 Orders 类后 OrdersCustom 类包括了 Orders 类的所有字段，只需要定义 用户的信息字段即可</p>
<p>Mapper.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有订单信息 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersList"</span> <span class="attr">resultType</span>=<span class="string">"cn.itcast.mybatis.po.OrdersCustom"</span>&gt;</span> </span><br><span class="line">SELECT orders.*, user.username, user.address </span><br><span class="line">FROM orders,user </span><br><span class="line">WHERE orders.user_id = user.id </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Mapper 接口<br>public List<orderscustom> findOrdersList() throws Exception;</orderscustom></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testfindOrdersList</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//查询订单信息 </span></span><br><span class="line">List&lt;OrdersCustom&gt; list = userMapper.findOrdersList(); </span><br><span class="line">System.out.println(list); </span><br><span class="line"><span class="comment">//关闭session s</span></span><br><span class="line">ession.close();</span><br></pre></td></tr></table></figure></p>
<h3 id="方法二：使用-resultMap"><a href="#方法二：使用-resultMap" class="headerlink" title="方法二：使用 resultMap"></a>方法二：使用 resultMap</h3><p>定义专门的 resultMap 用于映射一对一查询结果。</p>
<p>SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, user.username, user.address </span><br><span class="line"><span class="keyword">FROM</span> orders, <span class="keyword">user</span> </span><br><span class="line"><span class="keyword">WHERE</span> orders.user_id=user.id</span><br></pre></td></tr></table></figure>
<p>定义 po 类</p>
<p>在 Orders 类中加入 User 属性，user 属性中用于存储关联查询的用户信息，因为订单关联查询用户是一对一关系，所以这里使用单个 User 对象存储关联查询的用户信息。</p>
<p>Mapper.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersListResultMap"</span> <span class="attr">resultMap</span>=<span class="string">"userordermap"</span>&gt;</span> </span><br><span class="line">SELECT orders.*, user.username, user.address </span><br><span class="line">FROM orders,user </span><br><span class="line">WHERE orders.user_id = user.id </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里 resultMap 指定 userordermap 。</p>
<p>定义 resultMap:<br>需要关联查询映射的是用户信息，使用 association 将用户信息映射到订单对象的用户属性中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 订单信息resultmap --&gt; </span><br><span class="line">&lt;resultMap type=&quot;cn.itcast.mybatis.po.Orders&quot; id=&quot;userordermap&quot;&gt; </span><br><span class="line">&lt;!-- 这里的id，是mybatis在进行一对一查询时将user字段映射为user对象时要使用， 必须写 --&gt; </span><br><span class="line">&lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;user_id&quot; column=&quot;user_id&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;number&quot; column=&quot;number&quot;/&gt; </span><br><span class="line">&lt;association property=&quot;user&quot; javaType=&quot;cn.itcast.mybatis.po.User&quot;&gt; </span><br><span class="line">&lt;!-- 这里的id为user的id，如果写上表示给user的id属性赋值 --&gt; </span><br><span class="line">&lt;id property=&quot;id&quot; column=&quot;user_id&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;username&quot; column=&quot;username&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;address&quot; column=&quot;address&quot;/&gt; </span><br><span class="line">&lt;/association&gt; </span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure></p>
<p>association：表示进行关联查询单条记录<br>property：表示关联查询的结果存储在 cn.itcast.mybatis.po.Orders 的 user 属性中<br>javaType：表示关联查询的结果类型 </p>
<p><id property="id" column="user_id">：查询结果的 user_id 列对应关联对象的 id 属性，这里是<id>表示 user_id 是关联查询对象的唯一标识。 </id></id></p>
<p><result property="username" column="username">：查询结果的 username 列对应 关联对象的 username 属性。</result></p>
<h3 id="resultType-和resultMap小结"><a href="#resultType-和resultMap小结" class="headerlink" title="resultType 和resultMap小结"></a>resultType 和resultMap小结</h3><p>实现一对一查询<br>resultType：使用resultType简单，如果pojo中没有包括查询出来的列名，需要增加列名对应的属性，即可完成映射。如果没有查询结果的特殊要求，建议使用</p>
<p>resultMap：需要单独定义resultMap，实现有点麻烦，如果有对查询结果的特殊要求，使用resultMap可以完成将关联查询映射pojo的属性中</p>
<p>resultMap可以实现延迟加载，resultType不行。</p>
<h2 id="一对多查询"><a href="#一对多查询" class="headerlink" title="一对多查询"></a>一对多查询</h2><p>案例：查询所有订单信息及订单下的订单明细信息。<br>订单信息与订单明细为一对多关系。<br>使用 resultMap 实现如下：</p>
<h3 id="Sql-语句："><a href="#Sql-语句：" class="headerlink" title="Sql 语句："></a>Sql 语句：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, </span><br><span class="line">user.username, </span><br><span class="line">user.address, </span><br><span class="line">orderdetail.idorderdetail_id, </span><br><span class="line">orderdetail.items_id, </span><br><span class="line">orderdetail.items_num </span><br><span class="line"><span class="keyword">FROM</span> orders,<span class="keyword">user</span>,orderdetail</span><br><span class="line">WHEREorders.user_id=user.id </span><br><span class="line"><span class="keyword">AND</span> orders.id=orderdetail.orders_id</span><br></pre></td></tr></table></figure>
<h3 id="定义-po-类"><a href="#定义-po-类" class="headerlink" title="定义 po 类"></a>定义 po 类</h3><p>在 Orders 类中加入 User 属性。 在 Orders 类中加入 List<orderdetail>orderdetails 属性</orderdetail></p>
<p>Mapper.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersDetailList"</span> <span class="attr">resultMap</span>=<span class="string">"userorderdetailmap"</span>&gt;</span> </span><br><span class="line">SELECT orders.*, </span><br><span class="line">user.username,</span><br><span class="line"> user.address, </span><br><span class="line">orderdetail.id orderdetail_id, </span><br><span class="line">orderdetail.items_id, </span><br><span class="line">orderdetail.items_num </span><br><span class="line">FROM orders,user,orderdetail </span><br><span class="line">WHERE orders.user_id = user.id </span><br><span class="line">AND orders.id = orderdetail.orders_id <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="定义-resultMap"><a href="#定义-resultMap" class="headerlink" title="定义 resultMap"></a>定义 resultMap</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 订单信息resultmap --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span> <span class="attr">id</span>=<span class="string">"userorderdetailmap"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span><span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"user_id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"cn.itcast.mybatis.po.User"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orderdetails"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orderdetail"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"orderdetail_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_id"</span> <span class="attr">column</span>=<span class="string">"items_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_num"</span> <span class="attr">column</span>=<span class="string">"items_num"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>前半部分和上边一对一查询订单及用户信息定义的 resultMap 相同， collection 部分定义了查询订单明细信息。<br> collection：表示关联查询结果集<br>property=”orderdetails” ： 关联查询的结果集存储在 cn.itcast.mybatis.po.Orders 上哪个属性。<br>ofType=”cn.itcast.mybatis.po.Orderdetail” ： 指定关联查询的结果集中的对象类型 即 List 中的对象类型。</p>
<p><id>及<result>的意义同一对一查询。</result></id></p>
<p>resultMap 使用继承</p>
<p>上边定义的 resultMap 中上半部分和一对一查询订单信息的 resultMap 相同，这里使用继承 可以不再填写重复的内容，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span> <span class="attr">id</span>=<span class="string">"userorderdetailmap"</span> <span class="attr">extends</span>=<span class="string">"userordermap"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orderdetails"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orderdetail"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"orderdetail_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_id"</span> <span class="attr">column</span>=<span class="string">"items_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_num"</span> <span class="attr">column</span>=<span class="string">"items_num"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用 extends 继承订单信息 userordermap 。</p>
<h3 id="Mapper-接口："><a href="#Mapper-接口：" class="headerlink" title="Mapper 接口："></a>Mapper 接口：</h3><p>public List<orders>findOrdersDetailList () throws Exception;</orders></p>
<h3 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testfindOrdersDetailList</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//查询订单信息</span></span><br><span class="line">List&lt;Orders&gt; list = userMapper.findOrdersDetailList();</span><br><span class="line"> System.out.println(list); </span><br><span class="line"><span class="comment">//关闭session </span></span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>使用 collection 完成关联查询，将关联查询信息映射到集合对象。</p>
<h2 id="多对多查询"><a href="#多对多查询" class="headerlink" title="多对多查询"></a>多对多查询</h2><p>查询用户和商品之间的信息</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>查询用户购买的商品信息。</p>
<h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p>需要查询所有用户信息，关联查询订单及订单明细信息，订单明细信息中关联查询商品信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, </span><br><span class="line">USER.username, </span><br><span class="line">USER.address, </span><br><span class="line">orderdetail.idorderdetail_id, </span><br><span class="line">orderdetail.items_id, </span><br><span class="line">orderdetail.items_num, </span><br><span class="line">items.nameitems_name, </span><br><span class="line">items.detailitems_detail </span><br><span class="line"><span class="keyword">FROM</span> orders, </span><br><span class="line"><span class="keyword">USER</span>, </span><br><span class="line">orderdetail, </span><br><span class="line">items </span><br><span class="line"><span class="keyword">WHERE</span> orders.user_id=USER.id </span><br><span class="line"><span class="keyword">AND</span> orders.id=orderdetail.orders_id </span><br><span class="line"><span class="keyword">AND</span> orderdetail.items_id=items.id</span><br></pre></td></tr></table></figure>
<h3 id="po-定义"><a href="#po-定义" class="headerlink" title="po 定义"></a>po 定义</h3><p>在 User 中 添 加 List<orders> orders 属 性 ， 在 Orders 类 中 加 入 List<orderdetail> orderdetails 属性</orderdetail></orders></p>
<h3 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h3><p>需要关联查询映射的信息是：订单、订单明细、商品信息<br>订单：一个用户对应多个订单，使用 collection 映射到用户对象的订单列表属性中<br>订单明细：一个订单对应多个明细，使用 collection 映射到订单对象中的明细属性中<br>商品信息：一个订单明细对应一个商品，使用 association 映射到订单明细对象的商品属性中。 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一对多查询 查询用户信息、关联查询订单、订单明细信息、商品信息 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.User"</span> <span class="attr">id</span>=<span class="string">"userOrderListResultMap"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orders"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orderdetails"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orderdetail"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"orderdetail_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"ordersId"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"itemsId"</span> <span class="attr">column</span>=<span class="string">"items_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"itemsNum"</span> <span class="attr">column</span>=<span class="string">"items_num"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"items"</span> <span class="attr">javaType</span>=<span class="string">"cn.itcast.mybatis.po.Items"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"items_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"items_name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"items_detail"</span> <span class="attr">property</span>=<span class="string">"detail"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>一对多是多对多的特例，如下需求： 查询用户购买的商品信息，用户和商品的关系是多对多关系。<br>需求 1： 查询字段：用户账号、用户名称、用户性别、商品名称、商品价格(最常见) 企业开发中常见明细列表，用户购买商品明细列表， 使用 resultType 将上边查询列映射到 pojo 输出。</p>
<p>需求 2： 查询字段：用户账号、用户名称、购买商品数量、商品明细（鼠标移上显示明细） 使用 resultMap 将用户购买的商品明细列表映射到 user 对象中。</p>
<h2 id="resultMap-小结"><a href="#resultMap-小结" class="headerlink" title="resultMap 小结"></a>resultMap 小结</h2><p>resultType： 作用： 将查询结果按照 sql 列名 pojo 属性名一致性映射到 pojo 中。<br>场合： 常见一些明细记录的展示，比如用户购买商品明细，将关联查询信息全部展示在页面时， 此时可直接使用 resultType 将每一条记录映射到 pojo 中，在前端页面遍历 list（list 中是 pojo） 即可。</p>
<p>resultMap： 使用association和collection完成一对一和一对多高级映射（对结果有特殊的映射要求）。<br>association：<br>作用： 将关联查询信息映射到一个 pojo 对象中。<br>场合： 为了方便查询关联信息可以使用 association 将关联订单信息映射为用户对象的 pojo 属 性中，<br>比如：查询订单及关联用户信息。<br>使用 resultType 无法将查询结果映射到 pojo 对象的 pojo 属性中，根据对结果集查询遍 历的需要选择使用 resultType 还是 resultMap。<br>collection：<br>作用： 将关联查询信息映射到一个 list 集合中。<br>场合：为了方便查询遍历关联信息可以使用 collection 将关联信息映射到 list 集合中，<br>比如： 查询用户权限范围模块及模块下的菜单，可使用 collection 将模块映射到模块 list 中，将菜 单列表映射到模块对象的菜单 list 属性中，这样的作的目的也是方便对查询结果集进行遍历 查询。<br>如果使用 resultType 无法将查询结果映射到 list 集合中。</p>
<h2 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h2><p>需要查询关联信息时，使用 mybatis 延迟加载特性可有效的减少数据库压力，首次查询 只查询主要信息，关联信息等用户获取时再加载。</p>
<h3 id="打开延迟加载开关"><a href="#打开延迟加载开关" class="headerlink" title="打开延迟加载开关"></a>打开延迟加载开关</h3><p>在 mybatis 核心配置文件中配置： lazyLoadingEnabled、aggressiveLazyLoading</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>设置项</th>
<th>　描述　</th>
<th>允许值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>lazyLoadingEnabled</td>
<td>全局性设置懒加载，如果设为‘FALSE’，则所有相关联的都会被初始化加载</td>
<td>TRUE或FALSE</td>
<td>FALSE</td>
</tr>
<tr>
<td>aggressiveLazyLoading</td>
<td>当设置为‘true’的时候，懒加载的对象可能被任何懒属性全部加载，否则，每个属性都按需加载</td>
<td>true 或false</td>
<td>true</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="一对一查询延迟加载"><a href="#一对一查询延迟加载" class="headerlink" title="一对一查询延迟加载"></a>一对一查询延迟加载</h3><p>查询订单信息，关联查询用户信息。</p>
<ol>
<li><p>默认只查询订单信息<br>当需要查询用户信息时再去查询用户信息。在查询订单的statement中使用association去延迟加载下边的statement关联查询用户信息</p>
</li>
<li><p>关联查询用户信息<br>通过上边查询到的订单信息中的User_id去关联查询用户信息</p>
</li>
</ol>
<p>Sql 语句：<br>SELECT orders.* FROM orders</p>
<p>定义 po 类<br>在 Orders 类中加入 User 属性。</p>
<p>Mapper.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersList3"</span> <span class="attr">resultMap</span>=<span class="string">"userordermap2"</span>&gt;</span> </span><br><span class="line">SELECT orders.* </span><br><span class="line">FROM orders </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>定义 resultMap<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 订单信息resultmap --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span> <span class="attr">id</span>=<span class="string">"userordermap2"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"user_id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"cn.itcast.mybatis.po.User"</span> <span class="attr">select</span>=<span class="string">"findUserById"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>association：<br> select=”findUserById”：指定关联查询 sql 为 findUserById<br>column=”user_id”：关联查询时将 users_id 列的值传入 findUserById<br>最后将关联查询结果映射至 cn.itcast.mybatis.po.User 。</p>
<p>Mapper 接口：<br>public List<orders> findOrdersList3() throws Exception;</orders></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testfindOrdersList3</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">	SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">	UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//查询订单信息 </span></span><br><span class="line">	List&lt;Orders&gt; list = userMapper.findOrdersList3(); </span><br><span class="line">	System.out.println(list); </span><br><span class="line"><span class="comment">//开始加载，通过orders.getUser方法进行加载 </span></span><br><span class="line">	<span class="keyword">for</span>(Orders orders:list)&#123; </span><br><span class="line">		System.out.println(orders.getUser()); </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="comment">//关闭session </span></span><br><span class="line">session.close();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="延迟加载的思考"><a href="#延迟加载的思考" class="headerlink" title="延迟加载的思考"></a>延迟加载的思考</h3><p>不使用 mybatis 提供的延迟加载功能是否可以实现延迟加载？<br>实现方法： 针对订单和用户两个表定义两个 mapper 方法。<br>1、订单查询 mapper 方法<br>2、根据用户 id 查询用户信息 mapper 方法<br>默认使用订单查询 mapper 方法只查询订单信息。<br>当需要关联查询用户信息时再调用根据用户 id 查询用户信息 mapper 方法查询用户信息。</p>
<h1 id="查询缓存"><a href="#查询缓存" class="headerlink" title="查询缓存"></a>查询缓存</h1><p>mybatis 缓存介绍</p>
<img src="/posts/c574728f/2.png">
<p>Mybatis 一级缓存的作用域是同一个 SqlSession，在同一个 sqlSession 中两次执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取 数据将不再从数据库查询，从而提高查询效率。当一个 sqlSession 结束后该 sqlSession 中的 一级缓存也就不存在了。Mybatis 默认开启一级缓存。</p>
<p>Mybatis 二级缓存是多个 SqlSession 共享的，其作用域是 mapper 的同一个 namespace，不同 的 sqlSession 两次执行相同 namespace 下的 sql 语句且向 sql 中传递参数也相同即最终执行 相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从 缓存中获取数据将不再从数据库查询，从而提高查询效率。Mybatis 默认没有开启二级缓存 需要在 setting 全局参数中配置开启二级缓存。</p>
<h2 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h2><p>原理</p>
<p>下图是根据 id 查询用户的一级缓存图解：</p>
<img src="/posts/c574728f/3.png">
<p>一级缓存区域是根据 SqlSession 为单位划分的。<br>每次查询会先从缓存区域找，如果找不到从数据库查询，查询到数据将数据写入缓存。 </p>
<p>Mybatis 内部存储缓存使用一个 HashMap，key 为 hashCode+sqlId+Sql 语句。value 为 从查询出来映射生成的 java 对象</p>
<p>sqlSession 执行 insert、update、delete 等操作 commit 提交后会清空缓存区域。</p>
<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试 1"></a>测试 1</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//获取session </span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line">//获限mapper接口实例 </span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line"> //第一次查询 </span><br><span class="line">User user1 = userMapper.findUserById(1); </span><br><span class="line">System.out.println(user1); </span><br><span class="line">//第二次查询，由于是同一个session则不再向数据发出语句直接从缓存取出 </span><br><span class="line">User user2 = userMapper.findUserById(1); </span><br><span class="line">System.out.println(user2); </span><br><span class="line">//关闭session </span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>
<h3 id="测试-2"><a href="#测试-2" class="headerlink" title="测试 2"></a>测试 2</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//获取session </span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line">//获限mapper接口实例 </span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line">//第一次查询 </span><br><span class="line">User user1 = userMapper.findUserById(1);</span><br><span class="line"> System.out.println(user1); </span><br><span class="line">//在同一个session执行更新 </span><br><span class="line">User user_update = new User(); </span><br><span class="line">user_update.setId(1); </span><br><span class="line">user_update.setUsername("李奎"); </span><br><span class="line">userMapper.updateUser(user_update); </span><br><span class="line">session.commit(); </span><br><span class="line">//第二次查询，虽然是同一个session但是由于执行了更新操作session的缓存被 清空，这里重新发出sql操作 </span><br><span class="line">User user2 = userMapper.findUserById(1); </span><br><span class="line">System.out.println(user2);</span><br></pre></td></tr></table></figure>
<h2 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>下图是多个 sqlSession 请求 UserMapper 的二级缓存图解。</p>
<img src="/posts/c574728f/4.png">
<p>二级缓存区域是根据 mapper 的 namespace 划分的，相同 namespace 的 mapper 查询数据放 在同一个区域，如果使用 mapper 代理方法每个 mapper 的 namespace 都不同，此时可以理 解为二级缓存区域是根据 mapper 划分。 </p>
<p>每次查询会先从缓存区域找，如果找不到从数据库查询，查询到数据将数据写入缓存。</p>
<p>Mybatis 内部存储缓存使用一个 HashMap，key 为 hashCode+sqlId+Sql 语句。value 为 从查询出来映射生成的 java 对象 </p>
<p>sqlSession 执行 insert、update、delete 等操作 commit 提交后会清空缓存区域。</p>
<h3 id="开启二级缓存："><a href="#开启二级缓存：" class="headerlink" title="开启二级缓存："></a>开启二级缓存：</h3><p>在核心配置文件 SqlMapConfig.xml 中加入</p>
<setting name="cacheEnabled" value="true">


<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>描述</th>
<th>允许值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>cacheEnabled</td>
<td>对在此配置文件下的所有cache进行全局性开/关设置</td>
<td>true/false</td>
<td>true</td>
</tr>
</tbody>
</table>
</div>
<p>要在你Mapper 映射文件中添加一行： <cache>，表示此 mapper 开启二级缓存。</cache></p>
<h3 id="实现序列化"><a href="#实现序列化" class="headerlink" title="实现序列化"></a>实现序列化</h3><p>二级缓存需要查询结果映射的 pojo 对象实现 java.io.Serializable 接口实现序列化和反序 列化操作，注意如果存在父类、成员 pojo 都需要实现序列化接口。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">publicclassOrdersimplementsSerializable</span><br><span class="line">publicclassUserimplementsSerializable </span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取session1 </span></span><br><span class="line">SqlSession session1 = sqlSessionFactory.openSession(); </span><br><span class="line">UserMapper userMapper = session1.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//使用session1执行第一次查询 </span></span><br><span class="line">User user1 = userMapper.findUserById(<span class="number">1</span>); </span><br><span class="line">System.out.println(user1); </span><br><span class="line"><span class="comment">//关闭session1 </span></span><br><span class="line">session1.close(); </span><br><span class="line"><span class="comment">//获取session2 </span></span><br><span class="line">SqlSession session2 = sqlSessionFactory.openSession(); </span><br><span class="line">UserMapper userMapper2 = session2.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//使用session2执行第二次查询，由于开启了二级缓存这里从缓存中获取数据不 再向数据库发出sql </span></span><br><span class="line">User user2 = userMapper2.findUserById(<span class="number">1</span>); </span><br><span class="line">System.out.println(user2); </span><br><span class="line"><span class="comment">//关闭session2 </span></span><br><span class="line">session2.close();</span><br></pre></td></tr></table></figure>
<h3 id="禁用二级缓存"><a href="#禁用二级缓存" class="headerlink" title="禁用二级缓存"></a>禁用二级缓存</h3><p>在 statement 中设置 useCache=false 可以禁用当前 select 语句的二级缓存，即每次查询都会 发出 sql 去查询，默认情况是 true，即该 sql 使用二级缓存。 </p>
<selectid="findorderlistresultmap"resultmap="ordersusermap"usecache="false">


<h3 id="刷新缓存"><a href="#刷新缓存" class="headerlink" title="刷新缓存"></a>刷新缓存</h3><p>在 mapper 的同一个 namespace 中，如果有其它 insert、update、delete 操作数据后需要刷新 缓存，如果不执行刷新缓存会出现脏读。</p>
<p>设置 statement 配置中的 flushCache=”true” 属性，默认情况下为 true 即刷新缓存，如果改成 false 则不会刷新。使用缓存时如果手动修改数据库表中的查询数据会出现脏读。 如下： </p>
<insertid="insertuser"parametertype="cn.itcast.mybatis.po.user"flushcache="true">


<h3 id="MybatisCache-参数"><a href="#MybatisCache-参数" class="headerlink" title="MybatisCache 参数"></a>MybatisCache 参数</h3><p>flushInterval（刷新间隔）可以被设置为任意的正整数，而且它们代表一个合理的毫秒形式 的时间段。默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句时刷新。 </p>
<p>size（引用数目）可以被设置为任意正整数，要记住你缓存的对象数目和你运行环境的可用 内存资源数目。默认值是 1024。 </p>
<p>readOnly（只读）属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象 的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势。可读写的缓存会返回 缓存对象的拷贝（通过序列化）。这会慢一些，但是安全，因此默认是 false。</p>
<p>如下例子：</p>
<cache eviction="FIFO" flushinterval="60000" size="512" readonly="true">

<p>这个更高级的配置创建了一个FIFO 缓存,并每隔60 秒刷新,存数结果对象或列表的 512 个引 用,而且返回的对象被认为是只读的,因此在不同线程中的调用者之间修改它们会导致冲突。 可用的收回策略有,默认的是 LRU: </p>
<ol>
<li>LRU– 最近最少使用的:移除最长时间不被使用的对象。 </li>
<li>FIFO– 先进先出:按对象进入缓存的顺序来移除它们。 </li>
<li>SOFT– 软引用:移除基于垃圾回收器状态和软引用规则的对象。</li>
<li>WEAK– 弱引用:更积极地移除基于垃圾收集器状态和弱引用规则的对象。</li>
</ol>
<h3 id="mybatis-整合-ehcache"><a href="#mybatis-整合-ehcache" class="headerlink" title="mybatis 整合 ehcache"></a>mybatis 整合 ehcache</h3><p>EhCache 是一个纯 Java 的进程内缓存框架，是一种广泛使用的开源 Java 分布式缓存， 具有快速、精干等特点，是 Hibernate 中默认的 CacheProvider。<br>原理：</p>
<img src="/posts/c574728f/5.png">
<p>通过实现 Cache 接口可以实现 mybatis 缓存数据通过其它缓存数据库整合，mybatis 的特长 是 sql 操作，缓存数据的管理不是 mybatis 的特长，为了提高缓存的性能将 mybatis 和第三方 的缓存数据库整合，比如 ehcache、memcache、redis 等。</p>
<p>第一步：引入缓存的依赖包</p>
<p>ehcache-core-2.6.5.jar<br>mybatis-ehcache-1.0.2.jar</p>
<p>Maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二步：引入缓存配置文件</p>
<p>classpath 下添加：ehcache.xml 内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"../config/ehcache.xsd"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"F:\develop\ehcache"</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag"><span class="attr">maxElementsInMemory</span>=<span class="string">"1000"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">maxElementsOnDisk</span>=<span class="string">"10000000"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">eternal</span>=<span class="string">"false"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">overflowToDisk</span>=<span class="string">"false"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">timeToIdleSeconds</span>=<span class="string">"120"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">timeToLiveSeconds</span>=<span class="string">"120"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">"120"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LRU"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>属性说明：<br>diskStore ：指定数据在磁盘中的存储位置。<br>defaultCache ：当借助 CacheManager.add(“demoCache”)创建 Cache 时，EhCache 便 会采用<defalutcache>指定的的管理策略 </defalutcache></p>
<p>以下属性是必须的：</p>
<ul>
<li>maxElementsInMemory - 在内存中缓存的 element 的最大数目 </li>
<li>maxElementsOnDisk - 在磁盘上缓存的 element 的最大数目，若是 0 表示无穷大</li>
<li>eternal- 设定缓存的 elements 是否永远不过期。如果为 true，则缓存的数据始终有效， 如果为 false 那么还要根据 timeToIdleSeconds，timeToLiveSeconds 判断<br>overflowToDisk - 设定当内存缓存溢出的时候是否将过期的 element 缓存到磁盘上</li>
</ul>
<p>以下属性是可选的： </p>
<ul>
<li>timeToIdleSeconds - 当 缓 存 在 EhCache 中 的 数 据 前 后 两 次 访 问 的 时 间 超 过 timeToIdleSeconds 的属性取值时，这些数据便会删除，默认值是 0,也就是可闲置时间无穷 大 </li>
<li>timeToLiveSeconds - 缓存 element 的有效生命期，默认是 0.,也就是 element 存活时间 无穷大 </li>
<li>diskSpoolBufferSizeMB 这个参数设置 DiskStore(磁盘缓存)的缓存区大小.默认是 30MB.每个 Cache 都应该有自己的一个缓冲区. </li>
<li>diskPersistent- 在 VM 重启的时候是否启用磁盘保存 EhCache 中的数据，默认是 false。 </li>
<li>diskExpiryThreadIntervalSeconds - 磁盘缓存的清理线程运行间隔，默认是 120 秒。每 个 120s，相应的线程会进行一次 EhCache 中数据的清理工作 </li>
<li>memoryStoreEvictionPolicy - 当内存缓存达到最大，有新的 element 加入的时候， 移 除缓存中 element 的策略。默认是 LRU（最近最少使用），可选的有 LFU（最不常使用）和 FIFO（先进先出）</li>
</ul>
<p>第三步：开启 ehcache 缓存</p>
<p>EhcacheCache是ehcache对Cache接口的实现</p>
<p>修改mapper.xml文件，在cache中指定EhcacheCache<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache type=&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>根据需求调整缓存参数：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">"org.mybatis.caches.ehcache.EhcacheCache"</span> &gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeToIdleSeconds"</span> <span class="attr">value</span>=<span class="string">"3600"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeToLiveSeconds"</span> <span class="attr">value</span>=<span class="string">"3600"</span>/&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 同ehcache参数maxElementsInMemory --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxEntriesLocalHeap"</span> <span class="attr">value</span>=<span class="string">"1000"</span>/&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 同ehcache参数maxElementsOnDisk --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxEntriesLocalDisk"</span> <span class="attr">value</span>=<span class="string">"10000000"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"memoryStoreEvictionPolicy"</span> <span class="attr">value</span>=<span class="string">"LRU"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>对于访问多的查询请求且用户对查询结果实时性要求不高，此时可采用 mybatis 二级缓 存技术降低数据库访问量，提高访问速度，业务场景比如：耗时较高的统计分析 sql、电话 账单查询 sql 等。 </p>
<p>实现方法如下：通过设置刷新间隔时间，由 mybatis 每隔一段时间自动清空缓存，根据 数据变化频率设置缓存刷新间隔 flushInterval，比如设置为 30 分钟、60 分钟、24 小时等， 根据需求而定。</p>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><p>mybatis 二级缓存对细粒度的数据级别的缓存实现不好，比如如下需求：对商品信息进 行缓存，由于商品信息查询访问量大，但是要求用户每次都能查询最新的商品信息，此时如 果使用mybatis的二级缓存就无法实现当一个商品变化时只刷新该商品的缓存信息而不刷新 其它商品的信息，因为 mybaits 的二级缓存区域以 mapper 为单位划分，当一个商品信息变 化会将所有商品信息的缓存数据全部清空。解决此类问题需要在业务层根据需求对数据有针 对性缓存。</p>
<h1 id="spring与Mybatis整合"><a href="#spring与Mybatis整合" class="headerlink" title="spring与Mybatis整合"></a>spring与Mybatis整合</h1><p>实现 mybatis 与 spring 进行整合，通过 spring 管理 SqlSessionFactory、mapper 接口。</p>
<h2 id="mybatis-与-spring-整合-jar"><a href="#mybatis-与-spring-整合-jar" class="headerlink" title="mybatis 与 spring 整合 jar"></a>mybatis 与 spring 整合 jar</h2><p>mybatis 官方提供与 mybatis 与 spring 整合 jar 包：<br>mybatis_spring-1.2.2.jar<br>以及：<br>spring3.2.0<br>mybatis3.2.7<br>dbcp连接池<br>数据库驱动<br>等</p>
<h2 id="Mybatis配置文件"><a href="#Mybatis配置文件" class="headerlink" title="Mybatis配置文件"></a>Mybatis配置文件</h2><p>在classpath下创建mybatis/SqlMapConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt; </span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用自动扫描器时，mapper.xml文件如果和mapper.java接口在一个目录则此处不用 定义mappers --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.itcast.mybatis.mapper"</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Spring-配置文件："><a href="#Spring-配置文件：" class="headerlink" title="Spring 配置文件："></a>Spring 配置文件：</h2><p>在 classpath 下创建 applicationContext.xml，定义数据库链接池、SqlSessionFactory。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/contex t"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> </span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans-3. 2.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/mvc/spring-mvc-3.2.xs</span></span></span><br><span class="line"><span class="tag"><span class="string">d</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-contex t-3.2.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop/spring-aop-3.2.xs</span></span></span><br><span class="line"><span class="tag"><span class="string">d</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/tx/spring-tx-3.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 加载配置文件 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 数据库连接池 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"5"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- mapper配置 --&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 让spring管理sqlsessionfactory 使用mybatis和spring整合包 中的 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 数据库连接池 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 加载mybatis的全局配置文件 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis/SqlMapConfig.xml"</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：在定义 sqlSessionFactory 时指定数据源 dataSource 和 mybatis 的配置文件。</p>
<h2 id="Mapper-编写的三种方法"><a href="#Mapper-编写的三种方法" class="headerlink" title="Mapper 编写的三种方法"></a>Mapper 编写的三种方法</h2><h3 id="Dao-接口实现类继承-SqlSessionDaoSupport"><a href="#Dao-接口实现类继承-SqlSessionDaoSupport" class="headerlink" title="Dao 接口实现类继承 SqlSessionDaoSupport"></a>Dao 接口实现类继承 SqlSessionDaoSupport</h3><p>使用此种方法即原始 dao 开发方法，需要编写 dao 接口，dao 接口实现类、映射文件。</p>
<p>1、 在 sqlMapConfig.xml 中配置映射文件的位置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapperresource="mapper.xml</span> 文 件 的 地 址 "/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapperresource="mapper.xml</span> 文 件 的 地 址 "/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、 定义 dao 接口<br>3、dao 接口实现类集成 SqlSessionDaoSupport<br>dao 接口实现类方法中可以 this.getSqlSession()进行数据增删改查。<br>4、spring 配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">" "</span><span class="attr">class</span>=<span class="string">"mapper 接 口 的 实 现 "</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="使用-org-mybatis-spring-mapper-MapperFactoryBean"><a href="#使用-org-mybatis-spring-mapper-MapperFactoryBean" class="headerlink" title="使用 org.mybatis.spring.mapper.MapperFactoryBean"></a>使用 org.mybatis.spring.mapper.MapperFactoryBean</h3><p>此方法即 mapper 接口开发方法，只需定义 mapper 接口，不用编写 mapper 接口实现类。 每个 mapper 接口都需要在 spring 配置文件中定义。</p>
<p>1、 在 sqlMapConfig.xml 中配置 mapper.xml 的位置 如果 mapper.xml 和 mappre 接口的名称相同且在同一个目录，这里可以不用配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span> <span class="tag">&lt;<span class="name">mapperresource="mapper.xml</span> 文 件 的 地 址 "/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapperresource="mapper.xml</span> 文 件 的 地 址 "/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、 定义 mapper 接口</p>
<p>3、Spring 中定义</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperFactoryBean"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperInterface"</span> <span class="attr">value</span>=<span class="string">"mapper 接 口 地 址 "</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="使用-mapper-扫描器"><a href="#使用-mapper-扫描器" class="headerlink" title="使用 mapper 扫描器"></a>使用 mapper 扫描器</h3><p>此方法即 mapper 接口开发方法，只需定义 mapper 接口，不用编写 mapper 接口实现类。 只需要在 spring 配置文件中定义一个 mapper 扫描器，自动扫描包中的 mapper 接口生成代 代理对象。</p>
<p>1、mapper.xml 文件编写，<br>2、 定义 mapper 接口<br>注意 mapper.xml 的文件名和 mapper 的接口名称保持一致，且放在同一个目录</p>
<p>3、 配置 mapper 扫描器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"mapper 接 口 包 地 址 "</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>basePackage ： 扫 描 包 路 径 ， 中 间 可 以 用 逗 号 或 分 号 分 隔 定 义 多 个 包 </p>
<p>4、 使用扫描器后从 spring 容器中获取 mapper 的实现对象</p>
<p>如果将 mapper.xml 和 mapper 接口的名称保持一致且放在一个目录 则不用在 sqlMapConfig.xml 中进行配置</p>
<h1 id="Mybatis逆向工程"><a href="#Mybatis逆向工程" class="headerlink" title="Mybatis逆向工程"></a>Mybatis逆向工程</h1><p>Mybatis需要程序员自己编写SQL语句，Mybatis官方提供逆向工程，可以针对表单自动生成Mybatis执行所需要的代码（mappe.java ，mapper.xml ,po）</p>
<p>使用官方网站的 mapper 自动生成工具 mybatis-generator-core-1.3.2 来生成 po 类和 mapper 映射文件。</p>
<h2 id="第一步：mapper-生成配置文件："><a href="#第一步：mapper-生成配置文件：" class="headerlink" title="第一步：mapper 生成配置文件："></a>第一步：mapper 生成配置文件：</h2><p>在 generatorConfig.xml 中配置 mapper 生成的详细信息，注意改下几点：</p>
<p>1、 添加要生成的数据库表<br>2、po 文件所在包路径<br>3、mapper 文件所在包路径</p>
<p>配置文件如下： 详见 generatorSqlmapCustom 工程</p>
<h2 id="第二步：使用-java-类生成-mapper-文件："><a href="#第二步：使用-java-类生成-mapper-文件：" class="headerlink" title="第二步：使用 java 类生成 mapper 文件："></a>第二步：使用 java 类生成 mapper 文件：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">generator</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line">	List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;(); </span><br><span class="line">	<span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>; </span><br><span class="line">	File configFile = <span class="keyword">new</span> File(<span class="string">"generatorConfig.xml"</span>); </span><br><span class="line">	ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings); </span><br><span class="line">	Configuration config = cp.parseConfiguration(configFile); </span><br><span class="line">	DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite); </span><br><span class="line">	MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator (config, callback, warnings); </span><br><span class="line">	myBatisGenerator.generate(<span class="keyword">null</span>); </span><br><span class="line">	&#125; </span><br><span class="line"><span class="function">Public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">	<span class="keyword">try</span> &#123; </span><br><span class="line">		GeneratorSqlmap generatorSqlmap = <span class="keyword">new</span> GeneratorSqlmap(); </span><br><span class="line">		generatorSqlmap.generator(); </span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">		e.printStackTrace(); </span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第三步：拷贝生成的-mapper-文件到工程中指定的目录中"><a href="#第三步：拷贝生成的-mapper-文件到工程中指定的目录中" class="headerlink" title="第三步：拷贝生成的 mapper 文件到工程中指定的目录中"></a>第三步：拷贝生成的 mapper 文件到工程中指定的目录中</h2><p>Mapper.xml 的文件拷贝至 mapper 目录内</p>
<p>Mapper.java 的文件拷贝至 mapper 目录内</p>
<p>注意：mapperxml 文件和 mapper.java文件在一个目录内且文件名相同。</p>
<h2 id="第四步-Mapper-接口测试"><a href="#第四步-Mapper-接口测试" class="headerlink" title="第四步 Mapper 接口测试"></a>第四步 Mapper 接口测试</h2><p>学会使用 mapper 自动生成的增、删、改、查方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除符合条件的记录 </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteByExample</span><span class="params">(UserExample example)</span></span>;</span><br><span class="line"><span class="comment">//根据主键删除 </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(String id)</span></span>; </span><br><span class="line"><span class="comment">//插入对象所有字段 </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(User record)</span></span>; </span><br><span class="line"><span class="comment">//插入对象不为空的字段 </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(User record)</span></span>; </span><br><span class="line"><span class="comment">//自定义查询条件查询结果集 </span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">selectByExample</span><span class="params">(UserExample example)</span></span>; </span><br><span class="line"><span class="comment">//根据主键查询 </span></span><br><span class="line">UserselectByPrimaryKey(String id); </span><br><span class="line"><span class="comment">//根据主键将对象中不为空的值更新至数据库 </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(User record)</span></span>; </span><br><span class="line"><span class="comment">//根据主键将对象中所有字段的值更新至数据库 </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(User record)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="逆向工程注意事项"><a href="#逆向工程注意事项" class="headerlink" title="逆向工程注意事项"></a>逆向工程注意事项</h2><h3 id="Mapper-文件内容不覆盖而是追加"><a href="#Mapper-文件内容不覆盖而是追加" class="headerlink" title="Mapper 文件内容不覆盖而是追加"></a>Mapper 文件内容不覆盖而是追加</h3><p>XXXMapper.xml 文件已经存在时，如果进行重新生成则 mapper.xml 文件内容不被覆盖而是进 行内容追加，结果导致 mybatis 解析失败。 解决方法：删除原来已经生成的 mapperxml 文件再进行生成。 Mybatis 自动生成的 po 及 mapper.java 文件不是内容而是直接覆盖没有此问题。</p>
<h3 id="Tableschema-问题"><a href="#Tableschema-问题" class="headerlink" title="Tableschema 问题"></a>Tableschema 问题</h3><p>下边是关于针对 oracle 数据库表生成代码的 schema 问题：</p>
<p>Schma 即数据库模式，oracle 中一个用户对应一个 schema，可以理解为用户就是 schema。 当 Oralce 数据库存在多个 schema 可以访问相同的表名时，使用 mybatis 生成该表的 mapper.xml 将会出现 mapper.xml 内容重复的问题，结果导致 mybatis 解析错误。 </p>
<p>解决方法：在 table 中填写 schema，如下： </p>
<tableschema="xxxx"tablename="">

<p>XXXX 即为一个 schema 的名称，生成后将 mapper.xml 的 schema 前缀批量去掉，如果不去掉 当 oracle 用户变更了 sql 语句将查询失败。 </p>
<p>快捷操作方式：mapper.xml 文件中批量替换：“fromXXXX.”为空</p>
<p>Oracle 查询对象的 schema 可从 dba_objects 中查询，如下：</p>
<p>select * from dba_objects</p>
</tableschema="xxxx"tablename=""></cache></insertid="insertuser"parametertype="cn.itcast.mybatis.po.user"flushcache="true"></selectid="findorderlistresultmap"resultmap="ordersusermap"usecache="false"></setting>
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Just for fun!</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="Qsx 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

	<div>
		
			<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------<i class="fa fa-paw"></i> 文章已经到尾 <i class="fa fa-paw"></i>-------------</div>
    
</div>

		
	</div>
	
	
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/数据库/" rel="tag"># 数据库</a>
          
            <a href="/tags/学习/" rel="tag"># 学习</a>
          
            <a href="/tags/框架/" rel="tag"># 框架</a>
          
            <a href="/tags/Mybatis/" rel="tag"># Mybatis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/da3e1361.html" rel="next" title="Mybatis（一）">
                <i class="fa fa-chevron-left"></i> Mybatis（一）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/ae0f95e0.html" rel="prev" title="SpringMVC">
                SpringMVC <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Qsx" />
            
              <p class="site-author-name" itemprop="name">Qsx</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Shelhon" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ppp00qqq@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/qsxmybaby" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://zhihu.com/people/shelhon" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.kofes.cn/" title="cz" target="_blank">cz</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#关联查询"><span class="nav-number">1.</span> <span class="nav-text">关联查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#商品订单数据模型"><span class="nav-number">1.1.</span> <span class="nav-text">商品订单数据模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据模型分析思路"><span class="nav-number">1.1.1.</span> <span class="nav-text">数据模型分析思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据模型的分析"><span class="nav-number">1.1.2.</span> <span class="nav-text">数据模型的分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一对一查询"><span class="nav-number">1.2.</span> <span class="nav-text">一对一查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方法一：使用-resultType"><span class="nav-number">1.2.1.</span> <span class="nav-text">方法一：使用 resultType</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法二：使用-resultMap"><span class="nav-number">1.2.2.</span> <span class="nav-text">方法二：使用 resultMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultType-和resultMap小结"><span class="nav-number">1.2.3.</span> <span class="nav-text">resultType 和resultMap小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一对多查询"><span class="nav-number">1.3.</span> <span class="nav-text">一对多查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sql-语句："><span class="nav-number">1.3.1.</span> <span class="nav-text">Sql 语句：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义-po-类"><span class="nav-number">1.3.2.</span> <span class="nav-text">定义 po 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义-resultMap"><span class="nav-number">1.3.3.</span> <span class="nav-text">定义 resultMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mapper-接口："><span class="nav-number">1.3.4.</span> <span class="nav-text">Mapper 接口：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试："><span class="nav-number">1.3.5.</span> <span class="nav-text">测试：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">1.3.6.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多对多查询"><span class="nav-number">1.4.</span> <span class="nav-text">多对多查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#需求"><span class="nav-number">1.4.1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL"><span class="nav-number">1.4.2.</span> <span class="nav-text">SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#po-定义"><span class="nav-number">1.4.3.</span> <span class="nav-text">po 定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultMap"><span class="nav-number">1.4.4.</span> <span class="nav-text">resultMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-1"><span class="nav-number">1.4.5.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#resultMap-小结"><span class="nav-number">1.5.</span> <span class="nav-text">resultMap 小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#延迟加载"><span class="nav-number">1.6.</span> <span class="nav-text">延迟加载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#打开延迟加载开关"><span class="nav-number">1.6.1.</span> <span class="nav-text">打开延迟加载开关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一对一查询延迟加载"><span class="nav-number">1.6.2.</span> <span class="nav-text">一对一查询延迟加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#延迟加载的思考"><span class="nav-number">1.6.3.</span> <span class="nav-text">延迟加载的思考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#查询缓存"><span class="nav-number">2.</span> <span class="nav-text">查询缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一级缓存"><span class="nav-number">2.1.</span> <span class="nav-text">一级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-1"><span class="nav-number">2.1.1.</span> <span class="nav-text">测试 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-2"><span class="nav-number">2.1.2.</span> <span class="nav-text">测试 2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二级缓存"><span class="nav-number">2.2.</span> <span class="nav-text">二级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理"><span class="nav-number">2.2.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开启二级缓存："><span class="nav-number">2.2.2.</span> <span class="nav-text">开启二级缓存：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现序列化"><span class="nav-number">2.2.3.</span> <span class="nav-text">实现序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试"><span class="nav-number">2.2.4.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#禁用二级缓存"><span class="nav-number">2.2.5.</span> <span class="nav-text">禁用二级缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#刷新缓存"><span class="nav-number">2.2.6.</span> <span class="nav-text">刷新缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MybatisCache-参数"><span class="nav-number">2.2.7.</span> <span class="nav-text">MybatisCache 参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis-整合-ehcache"><span class="nav-number">2.2.8.</span> <span class="nav-text">mybatis 整合 ehcache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用场景"><span class="nav-number">2.2.9.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#局限性"><span class="nav-number">2.2.10.</span> <span class="nav-text">局限性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#spring与Mybatis整合"><span class="nav-number">3.</span> <span class="nav-text">spring与Mybatis整合</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis-与-spring-整合-jar"><span class="nav-number">3.1.</span> <span class="nav-text">mybatis 与 spring 整合 jar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis配置文件"><span class="nav-number">3.2.</span> <span class="nav-text">Mybatis配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-配置文件："><span class="nav-number">3.3.</span> <span class="nav-text">Spring 配置文件：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mapper-编写的三种方法"><span class="nav-number">3.4.</span> <span class="nav-text">Mapper 编写的三种方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dao-接口实现类继承-SqlSessionDaoSupport"><span class="nav-number">3.4.1.</span> <span class="nav-text">Dao 接口实现类继承 SqlSessionDaoSupport</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-org-mybatis-spring-mapper-MapperFactoryBean"><span class="nav-number">3.4.2.</span> <span class="nav-text">使用 org.mybatis.spring.mapper.MapperFactoryBean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-mapper-扫描器"><span class="nav-number">3.4.3.</span> <span class="nav-text">使用 mapper 扫描器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mybatis逆向工程"><span class="nav-number">4.</span> <span class="nav-text">Mybatis逆向工程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一步：mapper-生成配置文件："><span class="nav-number">4.1.</span> <span class="nav-text">第一步：mapper 生成配置文件：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二步：使用-java-类生成-mapper-文件："><span class="nav-number">4.2.</span> <span class="nav-text">第二步：使用 java 类生成 mapper 文件：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三步：拷贝生成的-mapper-文件到工程中指定的目录中"><span class="nav-number">4.3.</span> <span class="nav-text">第三步：拷贝生成的 mapper 文件到工程中指定的目录中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第四步-Mapper-接口测试"><span class="nav-number">4.4.</span> <span class="nav-text">第四步 Mapper 接口测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#逆向工程注意事项"><span class="nav-number">4.5.</span> <span class="nav-text">逆向工程注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mapper-文件内容不覆盖而是追加"><span class="nav-number">4.5.1.</span> <span class="nav-text">Mapper 文件内容不覆盖而是追加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tableschema-问题"><span class="nav-number">4.5.2.</span> <span class="nav-text">Tableschema 问题</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qsx</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">111.5k</span>
  
</div>










        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</body>

</html>
