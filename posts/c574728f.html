<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="数据库,学习,Mybatis,框架,"><meta name="description" content="Mybatis框架学习一、关联查询二、查询缓存三、与Spring整合四、Mybatis 逆向工程"><meta name="keywords" content="数据库,学习,Mybatis,框架"><meta property="og:type" content="article"><meta property="og:title" content="Mybatis（二）"><meta property="og:url" content="https://www.shelhon.cn/posts/c574728f.html"><meta property="og:site_name" content="无问西东"><meta property="og:description" content="Mybatis框架学习一、关联查询二、查询缓存三、与Spring整合四、Mybatis 逆向工程"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/1.png"><meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/2.png"><meta property="og:image" content="https://www.shelhon.cn/posts/c574728f/3.png"><meta property="og:updated_time" content="2018-10-09T06:17:13.691Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Mybatis（二）"><meta name="twitter:description" content="Mybatis框架学习一、关联查询二、查询缓存三、与Spring整合四、Mybatis 逆向工程"><meta name="twitter:image" content="https://www.shelhon.cn/posts/c574728f/1.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.shelhon.cn/posts/c574728f.html"><title>Mybatis（二） | 无问西东</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3275656b1c327868bf311aa7c5fdabd2";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/Shelhon/Shelhon.github.io" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64ceaa;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">无问西东</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">糊涂脸水聪明枕</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br> 公益404</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.shelhon.cn/posts/c574728f.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Qsx"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="无问西东"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Mybatis（二）</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-27T10:44:03+08:00">2018-09-27</time></span> <span class="post-updated">&nbsp; | &nbsp; 更新于 <time itemprop="dateUpdated" datetime="2018-10-09T14:17:13+08:00" content="2018-10-09">2018-10-09</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/学习过程/" itemprop="url" rel="index"><span itemprop="name">学习过程</span></a></span></span> <span class="post-meta-divider">|</span><span class="page-pv"><i class="fa fa-file-o"></i><span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">3,622</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">15</span></div></div></header><div class="post-body" itemprop="articleBody"><p><center><strong>Mybatis框架学习</strong></center><br>一、关联查询<br>二、查询缓存<br>三、与Spring整合<br>四、Mybatis 逆向工程</p><hr><a id="more"></a><h1 id="关联查询"><a href="#关联查询" class="headerlink" title="关联查询"></a>关联查询</h1><h2 id="商品订单数据模型"><a href="#商品订单数据模型" class="headerlink" title="商品订单数据模型"></a>商品订单数据模型</h2><h3 id="数据模型分析思路"><a href="#数据模型分析思路" class="headerlink" title="数据模型分析思路"></a>数据模型分析思路</h3><ol><li><p>每张表记录的数据内容<br>分模块对每张表记录的内容进行熟悉，相当于学习系统需求（功能）的过程</p></li><li><p>每张表数据库字段设置<br>非空字段，外键字段</p></li><li><p>数据库级别表与表之间的关系<br>外键关系</p></li><li>表与表之间的业务关系<br>在分析表与表之间的业务关系时一定要建立在某个业务意义基础上去分析</li></ol><h3 id="数据模型的分析"><a href="#数据模型的分析" class="headerlink" title="数据模型的分析"></a>数据模型的分析</h3><p>用户表User：<br>记录了购买商品的用户信息</p><p>订单表orders:<br>记录了用户所创建的订单</p><p>订单明细表odersdetail：<br>记录了订单的详细信息，即购买的商品信息</p><p>商品表：items<br>记录了商品信息</p> <img src="/posts/c574728f/1.png"><h2 id="一对一查询"><a href="#一对一查询" class="headerlink" title="一对一查询"></a>一对一查询</h2><p>查询订单信息，管理查询创建订单的与用户信息</p><p>注意：因为一个订单信息只会是一个人下的订单，所以从查询订单信息出发关联查询用户信 息为一对一查询。如果从用户信息出发查询用户下的订单信息则为一对多查询，因为一个用 户可以下多个订单。</p><h3 id="方法一：使用-resultType"><a href="#方法一：使用-resultType" class="headerlink" title="方法一：使用 resultType"></a>方法一：使用 resultType</h3><p>定义订单信息 po 类，此 po 类中包括了订单信息和用户信息</p><p>sql语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, user.username, userss.address </span><br><span class="line"><span class="keyword">FROM</span> orders, <span class="keyword">user</span> </span><br><span class="line"><span class="keyword">WHERE</span> orders.user_id=user.id</span><br></pre></td></tr></table></figure><p>定义 po 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrdersCustom</span> <span class="keyword">extends</span> <span class="title">Orders</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;<span class="comment">// 用户名称 </span></span><br><span class="line">    <span class="keyword">private</span> String address;<span class="comment">// 用户地址 </span></span><br><span class="line">    get/set。。。</span><br></pre></td></tr></table></figure><p>OrdersCustom 类继承 Orders 类后 OrdersCustom 类包括了 Orders 类的所有字段，只需要定义 用户的信息字段即可</p><p>Mapper.xml<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有订单信息 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersList"</span> <span class="attr">resultType</span>=<span class="string">"cn.itcast.mybatis.po.OrdersCustom"</span>&gt;</span> </span><br><span class="line">SELECT orders.*, user.username, user.address </span><br><span class="line">FROM orders,user </span><br><span class="line">WHERE orders.user_id = user.id </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>Mapper 接口<br>public List<orderscustom> findOrdersList() throws Exception;</orderscustom></p><p>测试：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testfindOrdersList</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//查询订单信息 </span></span><br><span class="line">List&lt;OrdersCustom&gt; list = userMapper.findOrdersList(); </span><br><span class="line">System.out.println(list); </span><br><span class="line"><span class="comment">//关闭session s</span></span><br><span class="line">ession.close();</span><br></pre></td></tr></table></figure><p></p><h3 id="方法二：使用-resultMap"><a href="#方法二：使用-resultMap" class="headerlink" title="方法二：使用 resultMap"></a>方法二：使用 resultMap</h3><p>定义专门的 resultMap 用于映射一对一查询结果。</p><p>SQL语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, user.username, user.address </span><br><span class="line"><span class="keyword">FROM</span> orders, <span class="keyword">user</span> </span><br><span class="line"><span class="keyword">WHERE</span> orders.user_id=user.id</span><br></pre></td></tr></table></figure><p>定义 po 类</p><p>在 Orders 类中加入 User 属性，user 属性中用于存储关联查询的用户信息，因为订单关联查询用户是一对一关系，所以这里使用单个 User 对象存储关联查询的用户信息。</p><p>Mapper.xml<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersListResultMap"</span> <span class="attr">resultMap</span>=<span class="string">"userordermap"</span>&gt;</span> </span><br><span class="line">SELECT orders.*, user.username, user.address </span><br><span class="line">FROM orders,user </span><br><span class="line">WHERE orders.user_id = user.id </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>这里 resultMap 指定 userordermap 。</p><p>定义 resultMap:<br>需要关联查询映射的是用户信息，使用 association 将用户信息映射到订单对象的用户属性中。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 订单信息resultmap --&gt; </span><br><span class="line">&lt;resultMap type=&quot;cn.itcast.mybatis.po.Orders&quot; id=&quot;userordermap&quot;&gt; </span><br><span class="line">&lt;!-- 这里的id，是mybatis在进行一对一查询时将user字段映射为user对象时要使用， 必须写 --&gt; </span><br><span class="line">&lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;user_id&quot; column=&quot;user_id&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;number&quot; column=&quot;number&quot;/&gt; </span><br><span class="line">&lt;association property=&quot;user&quot; javaType=&quot;cn.itcast.mybatis.po.User&quot;&gt; </span><br><span class="line">&lt;!-- 这里的id为user的id，如果写上表示给user的id属性赋值 --&gt; </span><br><span class="line">&lt;id property=&quot;id&quot; column=&quot;user_id&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;username&quot; column=&quot;username&quot;/&gt; </span><br><span class="line">&lt;result property=&quot;address&quot; column=&quot;address&quot;/&gt; </span><br><span class="line">&lt;/association&gt; </span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><p></p><p>association：表示进行关联查询单条记录<br>property：表示关联查询的结果存储在 cn.itcast.mybatis.po.Orders 的 user 属性中<br>javaType：表示关联查询的结果类型</p><p><id property="id" column="user_id">：查询结果的 user_id 列对应关联对象的 id 属性，这里是<id>表示 user_id 是关联查询对象的唯一标识。</id></id></p><p><result property="username" column="username">：查询结果的 username 列对应 关联对象的 username 属性。</result></p><h3 id="resultType-和resultMap小结"><a href="#resultType-和resultMap小结" class="headerlink" title="resultType 和resultMap小结"></a>resultType 和resultMap小结</h3><p>实现一对一查询<br>resultType：使用resultType简单，如果pojo中没有包括查询出来的列名，需要增加列名对应的属性，即可完成映射。如果没有查询结果的特殊要求，建议使用</p><p>resultMap：需要单独定义resultMap，实现有点麻烦，如果有对查询结果的特殊要求，使用resultMap可以完成将关联查询映射pojo的属性中</p><p>resultMap可以实现延迟加载，resultType不行。</p><h2 id="一对多查询"><a href="#一对多查询" class="headerlink" title="一对多查询"></a>一对多查询</h2><p>案例：查询所有订单信息及订单下的订单明细信息。<br>订单信息与订单明细为一对多关系。<br>使用 resultMap 实现如下：</p><h3 id="Sql-语句："><a href="#Sql-语句：" class="headerlink" title="Sql 语句："></a>Sql 语句：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, </span><br><span class="line">user.username, </span><br><span class="line">user.address, </span><br><span class="line">orderdetail.idorderdetail_id, </span><br><span class="line">orderdetail.items_id, </span><br><span class="line">orderdetail.items_num </span><br><span class="line"><span class="keyword">FROM</span> orders,<span class="keyword">user</span>,orderdetail</span><br><span class="line">WHEREorders.user_id=user.id </span><br><span class="line"><span class="keyword">AND</span> orders.id=orderdetail.orders_id</span><br></pre></td></tr></table></figure><h3 id="定义-po-类"><a href="#定义-po-类" class="headerlink" title="定义 po 类"></a>定义 po 类</h3><p>在 Orders 类中加入 User 属性。 在 Orders 类中加入 List<orderdetail>orderdetails 属性</orderdetail></p><p>Mapper.xml<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersDetailList"</span> <span class="attr">resultMap</span>=<span class="string">"userorderdetailmap"</span>&gt;</span> </span><br><span class="line">SELECT orders.*, </span><br><span class="line">user.username,</span><br><span class="line"> user.address, </span><br><span class="line">orderdetail.id orderdetail_id, </span><br><span class="line">orderdetail.items_id, </span><br><span class="line">orderdetail.items_num </span><br><span class="line">FROM orders,user,orderdetail </span><br><span class="line">WHERE orders.user_id = user.id </span><br><span class="line">AND orders.id = orderdetail.orders_id <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="定义-resultMap"><a href="#定义-resultMap" class="headerlink" title="定义 resultMap"></a>定义 resultMap</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 订单信息resultmap --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span> <span class="attr">id</span>=<span class="string">"userorderdetailmap"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span><span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"user_id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"cn.itcast.mybatis.po.User"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orderdetails"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orderdetail"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"orderdetail_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_id"</span> <span class="attr">column</span>=<span class="string">"items_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_num"</span> <span class="attr">column</span>=<span class="string">"items_num"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>前半部分和上边一对一查询订单及用户信息定义的 resultMap 相同， collection 部分定义了查询订单明细信息。<br> collection：表示关联查询结果集<br>property=”orderdetails” ： 关联查询的结果集存储在 cn.itcast.mybatis.po.Orders 上哪个属性。<br>ofType=”cn.itcast.mybatis.po.Orderdetail” ： 指定关联查询的结果集中的对象类型 即 List 中的对象类型。</p><p><id>及<result>的意义同一对一查询。</result></id></p><p>resultMap 使用继承</p><p>上边定义的 resultMap 中上半部分和一对一查询订单信息的 resultMap 相同，这里使用继承 可以不再填写重复的内容，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span> <span class="attr">id</span>=<span class="string">"userorderdetailmap"</span> <span class="attr">extends</span>=<span class="string">"userordermap"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orderdetails"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orderdetail"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"orderdetail_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_id"</span> <span class="attr">column</span>=<span class="string">"items_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"items_num"</span> <span class="attr">column</span>=<span class="string">"items_num"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用 extends 继承订单信息 userordermap 。</p><h3 id="Mapper-接口："><a href="#Mapper-接口：" class="headerlink" title="Mapper 接口："></a>Mapper 接口：</h3><p>public List<orders>findOrdersDetailList () throws Exception;</orders></p><h3 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testfindOrdersDetailList</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//查询订单信息</span></span><br><span class="line">List&lt;Orders&gt; list = userMapper.findOrdersDetailList();</span><br><span class="line"> System.out.println(list); </span><br><span class="line"><span class="comment">//关闭session </span></span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>使用 collection 完成关联查询，将关联查询信息映射到集合对象。</p><h2 id="多对多查询"><a href="#多对多查询" class="headerlink" title="多对多查询"></a>多对多查询</h2><p>查询用户和商品之间的信息</p><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>查询用户购买的商品信息。</p><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p>需要查询所有用户信息，关联查询订单及订单明细信息，订单明细信息中关联查询商品信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> orders.*, </span><br><span class="line">USER.username, </span><br><span class="line">USER.address, </span><br><span class="line">orderdetail.idorderdetail_id, </span><br><span class="line">orderdetail.items_id, </span><br><span class="line">orderdetail.items_num, </span><br><span class="line">items.nameitems_name, </span><br><span class="line">items.detailitems_detail </span><br><span class="line"><span class="keyword">FROM</span> orders, </span><br><span class="line"><span class="keyword">USER</span>, </span><br><span class="line">orderdetail, </span><br><span class="line">items </span><br><span class="line"><span class="keyword">WHERE</span> orders.user_id=USER.id </span><br><span class="line"><span class="keyword">AND</span> orders.id=orderdetail.orders_id </span><br><span class="line"><span class="keyword">AND</span> orderdetail.items_id=items.id</span><br></pre></td></tr></table></figure><h3 id="po-定义"><a href="#po-定义" class="headerlink" title="po 定义"></a>po 定义</h3><p>在 User 中 添 加 List<orders> orders 属 性 ， 在 Orders 类 中 加 入 List<orderdetail> orderdetails 属性</orderdetail></orders></p><h3 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h3><p>需要关联查询映射的信息是：订单、订单明细、商品信息<br>订单：一个用户对应多个订单，使用 collection 映射到用户对象的订单列表属性中<br>订单明细：一个订单对应多个明细，使用 collection 映射到订单对象中的明细属性中<br>商品信息：一个订单明细对应一个商品，使用 association 映射到订单明细对象的商品属性中。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一对多查询 查询用户信息、关联查询订单、订单明细信息、商品信息 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.User"</span> <span class="attr">id</span>=<span class="string">"userOrderListResultMap"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orders"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orderdetails"</span> <span class="attr">ofType</span>=<span class="string">"cn.itcast.mybatis.po.Orderdetail"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"orderdetail_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"ordersId"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"itemsId"</span> <span class="attr">column</span>=<span class="string">"items_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"itemsNum"</span> <span class="attr">column</span>=<span class="string">"items_num"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"items"</span> <span class="attr">javaType</span>=<span class="string">"cn.itcast.mybatis.po.Items"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"items_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"items_name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"items_detail"</span> <span class="attr">property</span>=<span class="string">"detail"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>一对多是多对多的特例，如下需求： 查询用户购买的商品信息，用户和商品的关系是多对多关系。<br>需求 1： 查询字段：用户账号、用户名称、用户性别、商品名称、商品价格(最常见) 企业开发中常见明细列表，用户购买商品明细列表， 使用 resultType 将上边查询列映射到 pojo 输出。</p><p>需求 2： 查询字段：用户账号、用户名称、购买商品数量、商品明细（鼠标移上显示明细） 使用 resultMap 将用户购买的商品明细列表映射到 user 对象中。</p><h2 id="resultMap-小结"><a href="#resultMap-小结" class="headerlink" title="resultMap 小结"></a>resultMap 小结</h2><p>resultType： 作用： 将查询结果按照 sql 列名 pojo 属性名一致性映射到 pojo 中。<br>场合： 常见一些明细记录的展示，比如用户购买商品明细，将关联查询信息全部展示在页面时， 此时可直接使用 resultType 将每一条记录映射到 pojo 中，在前端页面遍历 list（list 中是 pojo） 即可。</p><p>resultMap： 使用association和collection完成一对一和一对多高级映射（对结果有特殊的映射要求）。<br>association：<br>作用： 将关联查询信息映射到一个 pojo 对象中。<br>场合： 为了方便查询关联信息可以使用 association 将关联订单信息映射为用户对象的 pojo 属 性中，<br>比如：查询订单及关联用户信息。<br>使用 resultType 无法将查询结果映射到 pojo 对象的 pojo 属性中，根据对结果集查询遍 历的需要选择使用 resultType 还是 resultMap。<br>collection：<br>作用： 将关联查询信息映射到一个 list 集合中。<br>场合：为了方便查询遍历关联信息可以使用 collection 将关联信息映射到 list 集合中，<br>比如： 查询用户权限范围模块及模块下的菜单，可使用 collection 将模块映射到模块 list 中，将菜 单列表映射到模块对象的菜单 list 属性中，这样的作的目的也是方便对查询结果集进行遍历 查询。<br>如果使用 resultType 无法将查询结果映射到 list 集合中。</p><h2 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h2><p>需要查询关联信息时，使用 mybatis 延迟加载特性可有效的减少数据库压力，首次查询 只查询主要信息，关联信息等用户获取时再加载。</p><h3 id="打开延迟加载开关"><a href="#打开延迟加载开关" class="headerlink" title="打开延迟加载开关"></a>打开延迟加载开关</h3><p>在 mybatis 核心配置文件中配置： lazyLoadingEnabled、aggressiveLazyLoading</p><table><thead><tr><th>设置项</th><th>　描述　</th><th>允许值</th><th>默认值</th></tr></thead><tbody><tr><td>lazyLoadingEnabled</td><td>全局性设置懒加载，如果设为‘FALSE’，则所有相关联的都会被初始化加载</td><td>TRUE或FALSE</td><td>FALSE</td></tr><tr><td>aggressiveLazyLoading</td><td>当设置为‘true’的时候，懒加载的对象可能被任何懒属性全部加载，否则，每个属性都按需加载</td><td>true 或false</td><td>true</td></tr></tbody></table><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="一对一查询延迟加载"><a href="#一对一查询延迟加载" class="headerlink" title="一对一查询延迟加载"></a>一对一查询延迟加载</h3><p>查询订单信息，关联查询用户信息。</p><ol><li><p>默认只查询订单信息<br>当需要查询用户信息时再去查询用户信息。在查询订单的statement中使用association去延迟加载下边的statement关联查询用户信息</p></li><li><p>关联查询用户信息<br>通过上边查询到的订单信息中的User_id去关联查询用户信息</p></li></ol><p>Sql 语句：<br>SELECT orders.* FROM orders</p><p>定义 po 类<br>在 Orders 类中加入 User 属性。</p><p>Mapper.xml<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersList3"</span> <span class="attr">resultMap</span>=<span class="string">"userordermap2"</span>&gt;</span> </span><br><span class="line">SELECT orders.* </span><br><span class="line">FROM orders </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>定义 resultMap<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 订单信息resultmap --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.itcast.mybatis.po.Orders"</span> <span class="attr">id</span>=<span class="string">"userordermap2"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"user_id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"cn.itcast.mybatis.po.User"</span> <span class="attr">select</span>=<span class="string">"findUserById"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>association：<br> select=”findUserById”：指定关联查询 sql 为 findUserById<br>column=”user_id”：关联查询时将 users_id 列的值传入 findUserById<br>最后将关联查询结果映射至 cn.itcast.mybatis.po.User 。</p><p>Mapper 接口：<br>public List<orders> findOrdersList3() throws Exception;</orders></p><p>测试：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">testfindOrdersList3</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line"><span class="comment">//获取session </span></span><br><span class="line">	SqlSession session = sqlSessionFactory.openSession(); </span><br><span class="line"><span class="comment">//获限mapper接口实例 </span></span><br><span class="line">	UserMapper userMapper = session.getMapper(UserMapper.class); </span><br><span class="line"><span class="comment">//查询订单信息 </span></span><br><span class="line">	List&lt;Orders&gt; list = userMapper.findOrdersList3(); </span><br><span class="line">	System.out.println(list); </span><br><span class="line"><span class="comment">//开始加载，通过orders.getUser方法进行加载 </span></span><br><span class="line">	<span class="keyword">for</span>(Orders orders:list)&#123; </span><br><span class="line">		System.out.println(orders.getUser()); </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="comment">//关闭session </span></span><br><span class="line">session.close();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="延迟加载的思考"><a href="#延迟加载的思考" class="headerlink" title="延迟加载的思考"></a>延迟加载的思考</h3><p>不使用 mybatis 提供的延迟加载功能是否可以实现延迟加载？<br>实现方法： 针对订单和用户两个表定义两个 mapper 方法。<br>1、订单查询 mapper 方法<br>2、根据用户 id 查询用户信息 mapper 方法<br>默认使用订单查询 mapper 方法只查询订单信息。<br>当需要关联查询用户信息时再调用根据用户 id 查询用户信息 mapper 方法查询用户信息。</p><h1 id="查询缓存"><a href="#查询缓存" class="headerlink" title="查询缓存"></a>查询缓存</h1><p>mybatis 缓存介绍</p> <img src="/posts/c574728f/2.png"><p>Mybatis 一级缓存的作用域是同一个 SqlSession，在同一个 sqlSession 中两次执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取 数据将不再从数据库查询，从而提高查询效率。当一个 sqlSession 结束后该 sqlSession 中的 一级缓存也就不存在了。Mybatis 默认开启一级缓存。</p><p>Mybatis 二级缓存是多个 SqlSession 共享的，其作用域是 mapper 的同一个 namespace，不同 的 sqlSession 两次执行相同 namespace 下的 sql 语句且向 sql 中传递参数也相同即最终执行 相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从 缓存中获取数据将不再从数据库查询，从而提高查询效率。Mybatis 默认没有开启二级缓存 需要在 setting 全局参数中配置开启二级缓存。</p><h2 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h2><p>原理</p><p>下图是根据 id 查询用户的一级缓存图解：</p> <img src="/posts/c574728f/3.png"><p>一级缓存区域是根据 SqlSession 为单位划分的。<br>每次查询会先从缓存区域找，如果找不到从数据库查询，查询到数据将数据写入缓存。</p><p>Mybatis 内部存储缓存使用一个 HashMap，key 为 hashCode+sqlId+Sql 语句。value 为 从查询出来映射生成的 java 对象</p><p>sqlSession 执行 insert、update、delete 等操作 commit 提交后会清空缓存区域。</p></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>Just for fun!</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.jpg" alt="Qsx 微信支付"><p>微信支付</p></div></div></div></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------<i class="fa fa-paw"></i> 文章已经到尾<i class="fa fa-paw"></i> -------------</div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/数据库/" rel="tag"># 数据库</a> <a href="/tags/学习/" rel="tag"># 学习</a> <a href="/tags/Mybatis/" rel="tag"># Mybatis</a> <a href="/tags/框架/" rel="tag"># 框架</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/da3e1361.html" rel="next" title="Mybatis（一）"><i class="fa fa-chevron-left"></i> Mybatis（一）</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Qsx"><p class="site-author-name" itemprop="name">Qsx</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">14</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">4</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">12</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Shelhon" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:ppp00qqq@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="http://weibo.com/qsxmybaby" target="_blank" title="微博"><i class="fa fa-fw fa-weibo"></i> 微博</a></span><span class="links-of-author-item"><a href="https://zhihu.com/people/shelhon" target="_blank" title="知乎"><i class="fa fa-fw fa-globe"></i> 知乎</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://www.kofes.cn/" title="cz" target="_blank">cz</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#关联查询"><span class="nav-number">1.</span> <span class="nav-text">关联查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#商品订单数据模型"><span class="nav-number">1.1.</span> <span class="nav-text">商品订单数据模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据模型分析思路"><span class="nav-number">1.1.1.</span> <span class="nav-text">数据模型分析思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据模型的分析"><span class="nav-number">1.1.2.</span> <span class="nav-text">数据模型的分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一对一查询"><span class="nav-number">1.2.</span> <span class="nav-text">一对一查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方法一：使用-resultType"><span class="nav-number">1.2.1.</span> <span class="nav-text">方法一：使用 resultType</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法二：使用-resultMap"><span class="nav-number">1.2.2.</span> <span class="nav-text">方法二：使用 resultMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultType-和resultMap小结"><span class="nav-number">1.2.3.</span> <span class="nav-text">resultType 和resultMap小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一对多查询"><span class="nav-number">1.3.</span> <span class="nav-text">一对多查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sql-语句："><span class="nav-number">1.3.1.</span> <span class="nav-text">Sql 语句：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义-po-类"><span class="nav-number">1.3.2.</span> <span class="nav-text">定义 po 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义-resultMap"><span class="nav-number">1.3.3.</span> <span class="nav-text">定义 resultMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mapper-接口："><span class="nav-number">1.3.4.</span> <span class="nav-text">Mapper 接口：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试："><span class="nav-number">1.3.5.</span> <span class="nav-text">测试：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">1.3.6.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多对多查询"><span class="nav-number">1.4.</span> <span class="nav-text">多对多查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#需求"><span class="nav-number">1.4.1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL"><span class="nav-number">1.4.2.</span> <span class="nav-text">SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#po-定义"><span class="nav-number">1.4.3.</span> <span class="nav-text">po 定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultMap"><span class="nav-number">1.4.4.</span> <span class="nav-text">resultMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-1"><span class="nav-number">1.4.5.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#resultMap-小结"><span class="nav-number">1.5.</span> <span class="nav-text">resultMap 小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#延迟加载"><span class="nav-number">1.6.</span> <span class="nav-text">延迟加载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#打开延迟加载开关"><span class="nav-number">1.6.1.</span> <span class="nav-text">打开延迟加载开关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一对一查询延迟加载"><span class="nav-number">1.6.2.</span> <span class="nav-text">一对一查询延迟加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#延迟加载的思考"><span class="nav-number">1.6.3.</span> <span class="nav-text">延迟加载的思考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#查询缓存"><span class="nav-number">2.</span> <span class="nav-text">查询缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一级缓存"><span class="nav-number">2.1.</span> <span class="nav-text">一级缓存</span></a></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Qsx</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">105.7k</span></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span><span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/love.js"></script></body></html>